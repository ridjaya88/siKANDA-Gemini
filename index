<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SIKANDA - Kanwil BPN NTB | Bidang Pengendalian & Penanganan Sengketa</title>
<link href="https://fonts.googleapis.com/css2?family=Josefin+Sans:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;1,100;1,300;1,400&family=Share+Tech+Mono&display=swap" rel="stylesheet">
<style>
  :root {
    --neon: #c8ff00;
    --neon2: #b8eb00;
    --neon-dim: rgba(200,255,0,0.08);
    --neon-glow: none;
    --neon-text: none;
    --bg: #0d0d0d;
    --bg2: #111111;
    --bg3: #161616;
    --bg4: #1a1a1a;
    --surface: rgba(20,20,20,0.97);
    --surface2: rgba(200,255,0,0.04);
    --border: rgba(255,255,255,0.08);
    --border-bright: rgba(200,255,0,0.45);
    --text: #a0a0a0;
    --text-dim: #8a8a8a; /* Diperbaiki agar lebih kontras dan terbaca */
    --text-bright: #ffffff;
    --danger: #ff3d55;
    --warning: #ffaa00;
    --info: #4db8ff;
    --sidebar-w: 260px;
    --header-h: 64px;
  }

  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
  html { font-size: 14px; }
  body {
    font-family: 'Josefin Sans', sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* Grid bg */
  body::before {
    content: ''; position: fixed; inset: 0;
    background-image: linear-gradient(rgba(255,255,255,0.025) 1px, transparent 1px), linear-gradient(90deg, rgba(255,255,255,0.025) 1px, transparent 1px);
    background-size: 40px 40px; pointer-events: none; z-index: 0;
  }
  body::after {
    content: ''; position: fixed; top: -40%; left: -20%; width: 600px; height: 600px;
    background: radial-gradient(circle, rgba(200,255,0,0.03) 0%, transparent 70%); pointer-events: none; z-index: 0;
  }

  /* ===== LOGIN OVERLAY ===== */
  #login-overlay {
    position: fixed; inset: 0; background: var(--bg); z-index: 99999;
    display: flex; align-items: center; justify-content: center;
    backdrop-filter: blur(10px); transition: opacity 0.5s ease;
  }
  .login-box {
    background: var(--surface); border: 1px solid var(--border-bright);
    padding: 40px; border-radius: 16px; width: 100%; max-width: 400px;
    text-align: center; box-shadow: 0 0 30px rgba(200,255,0,0.1);
  }
  .login-box h1 { color: var(--neon); font-size: 24px; letter-spacing: 3px; margin-bottom: 10px; }
  .login-box p { color: var(--text-dim); margin-bottom: 30px; font-size: 12px; }
  .login-box input { width: 100%; padding: 12px; margin-bottom: 20px; text-align: center; letter-spacing: 2px; }

  /* ===== SIDEBAR ===== */
  #sidebar {
    position: fixed; left: 0; top: 0; bottom: 0; width: var(--sidebar-w);
    background: var(--bg2); border-right: 1px solid var(--border);
    z-index: 100; display: flex; flex-direction: column; overflow: hidden;
    transition: width 0.35s cubic-bezier(.77,0,.18,1);
  }
  #sidebar.collapsed { width: 64px; }
  .sidebar-header { padding: 16px 12px; border-bottom: 1px solid var(--border); flex-shrink: 0; display: flex; align-items: center; justify-content: space-between; gap: 8px; min-height: 64px; }
  #sidebar.collapsed .sidebar-header { justify-content: center; }
  .logo-mark { display: flex; align-items: center; gap: 12px; overflow: hidden; }
  .logo-icon { width: 36px; height: 36px; background: var(--neon); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-weight: 900; font-size: 14px; color: #000; flex-shrink: 0; }
  .logo-text { overflow: hidden; white-space: nowrap; }
  .logo-title { font-size: 13px; font-weight: 700; color: var(--neon); letter-spacing: 2px; }
  .logo-sub { font-size: 9px; color: var(--text-dim); letter-spacing: 1px; line-height: 1.4; margin-top: 2px; }
  .sidebar-nav { flex: 1; overflow-y: auto; padding: 12px 8px; scrollbar-width: thin; scrollbar-color: var(--border) transparent; }
  .nav-section-label { font-size: 9px; letter-spacing: 2px; color: var(--text-dim); padding: 8px 8px 4px; text-transform: uppercase; white-space: nowrap; transition: opacity 0.3s; }
  #sidebar.collapsed .nav-section-label { opacity: 0; }
  .nav-item { display: flex; align-items: center; gap: 12px; padding: 10px 12px; border-radius: 8px; cursor: pointer; margin-bottom: 2px; transition: all 0.2s ease; position: relative; overflow: hidden; white-space: nowrap; border: 1px solid transparent; }
  .nav-item:hover { background: var(--neon-dim); border-color: var(--border); color: var(--neon); }
  .nav-item.active { background: rgba(200,255,0,0.07); border-color: var(--border-bright); color: var(--neon); }
  .nav-item.active::before { content: ''; position: absolute; left: 0; top: 0; bottom: 0; width: 3px; background: var(--neon); }
  .nav-icon { width: 20px; height: 20px; flex-shrink: 0; display: flex; align-items: center; justify-content: center; }
  .nav-icon svg { width: 18px; height: 18px; }
  .nav-label { font-size: 13px; font-weight: 500; letter-spacing: 0.5px; overflow: hidden; text-overflow: ellipsis; }
  .nav-badge { margin-left: auto; background: var(--neon); color: #000; font-size: 10px; font-weight: 700; padding: 1px 6px; border-radius: 10px; flex-shrink: 0; transition: transform 0.2s; }
  .sidebar-footer { padding: 12px; border-top: 1px solid var(--border); flex-shrink: 0; }
  .user-card { display: flex; align-items: center; gap: 10px; padding: 10px; border-radius: 8px; background: var(--neon-dim); border: 1px solid var(--border); overflow: hidden; }
  .user-avatar { width: 32px; height: 32px; border-radius: 50%; background: var(--neon); display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: 700; color: #000; flex-shrink: 0; }
  .user-info { overflow: hidden; }
  .user-name { font-size: 12px; font-weight: 600; color: var(--text-bright); white-space: nowrap; }
  .user-role { font-size: 10px; color: var(--text-dim); white-space: nowrap; }
  #collapse-btn { display: flex; align-items: center; justify-content: center; width: 32px; height: 32px; border-radius: 8px; border: 1px solid var(--border); background: transparent; color: var(--text-dim); cursor: pointer; transition: all 0.22s ease; flex-shrink: 0; }
  #collapse-btn:hover { background: var(--neon-dim); border-color: var(--border-bright); color: var(--neon); }
  #collapse-btn svg { width: 16px; height: 16px; transition: transform 0.35s cubic-bezier(.77,0,.18,1); }
  #sidebar.collapsed #collapse-btn svg { transform: rotate(180deg); }
  #sidebar.collapsed #collapse-btn { margin: 0 auto; }

  /* ===== BACK BUTTON ===== */
  #back-btn { display: none; align-items: center; justify-content: center; width: 34px; height: 34px; border-radius: 8px; border: 1px solid var(--border); background: transparent; color: var(--text-dim); cursor: pointer; transition: all 0.2s ease; flex-shrink: 0; margin-right: 4px; }
  #back-btn:hover { background: var(--neon-dim); border-color: var(--neon); color: var(--neon); transform: translateX(-2px); }
  #back-btn.visible { display: flex; }

  /* ===== HEADER ===== */
  #header { position: fixed; top: 0; left: var(--sidebar-w); right: 0; height: var(--header-h); background: rgba(13,13,13,0.97); border-bottom: 1px solid var(--border); backdrop-filter: blur(10px); z-index: 99; display: flex; align-items: center; padding: 0 24px; gap: 16px; transition: left 0.35s cubic-bezier(.77,0,.18,1); }
  #sidebar.collapsed ~ #header { left: 64px; }
  .page-title { font-size: 14px; font-weight: 600; color: var(--neon); letter-spacing: 2px; }
  .breadcrumb { font-size: 11px; color: var(--text-dim); letter-spacing: 1px; }
  .header-right { margin-left: auto; display: flex; align-items: center; gap: 12px; }
  .header-clock { font-family: 'Share Tech Mono', monospace; font-size: 13px; color: var(--neon); letter-spacing: 2px; }

  .btn { display: inline-flex; align-items: center; gap: 6px; padding: 7px 16px; border-radius: 6px; font-family: 'Josefin Sans', sans-serif; font-size: 12px; font-weight: 600; letter-spacing: 1px; cursor: pointer; transition: all 0.2s ease; border: none; text-transform: uppercase; }
  .btn-primary { background: var(--neon); color: #000; }
  .btn-primary:hover { background: #d4ff1a; transform: translateY(-1px); }
  .btn-ghost { background: transparent; color: var(--neon); border: 1px solid var(--border-bright); }
  .btn-ghost:hover { background: var(--neon-dim); border-color: var(--neon); }
  .btn-danger { background: transparent; color: var(--danger); border: 1px solid rgba(255,77,106,0.4); }
  .btn-danger:hover { background: rgba(255,77,106,0.1); }
  .btn-export { background: rgba(77,184,255,0.1); color: var(--info); border: 1px solid rgba(77,184,255,0.3); }
  .btn-export:hover { background: rgba(77,184,255,0.2); }

  /* ===== MAIN CONTENT ===== */
  #main { margin-left: var(--sidebar-w); margin-top: var(--header-h); padding: 24px; min-height: calc(100vh - var(--header-h)); position: relative; z-index: 1; transition: margin-left 0.35s cubic-bezier(.77,0,.18,1); }
  #sidebar.collapsed ~ #header ~ #main, #sidebar.collapsed + #header + #main { margin-left: 64px; }
  .page { display: none; animation: pageIn 0.4s cubic-bezier(.25,.46,.45,.94) forwards; }
  .page.active { display: block; }
  @keyframes pageIn { from { opacity: 0; transform: translateY(16px) scale(0.98); filter: blur(4px); } to { opacity: 1; transform: translateY(0) scale(1); filter: blur(0); } }
  @keyframes fadeUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

  .card { background: var(--surface); border: 1px solid var(--border); border-radius: 12px; padding: 20px; position: relative; overflow: hidden; backdrop-filter: blur(10px); }
  .card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 1px; background: linear-gradient(90deg, transparent, var(--neon), transparent); opacity: 0; transition: opacity 0.3s; }
  .card:hover::before { opacity: 1; }
  .card-title { font-size: 11px; font-weight: 600; letter-spacing: 2px; color: var(--text-dim); text-transform: uppercase; margin-bottom: 12px; }

  /* ===== STAT CARDS ===== */
  .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 16px; margin-bottom: 24px; }
  .stat-card { background: var(--surface); border: 1px solid var(--border); border-radius: 12px; padding: 20px; position: relative; cursor: pointer; transition: all 0.3s ease; animation: fadeUp 0.5s ease forwards; opacity: 0; }
  .stat-card:hover { border-color: var(--border-bright); transform: translateY(-3px); box-shadow: 0 8px 24px rgba(0,0,0,0.3); }
  .stat-card::after { content: ''; position: absolute; bottom: 0; left: 0; right: 0; height: 2px; background: linear-gradient(90deg, var(--neon), transparent); }
  .stat-value { font-size: 32px; font-weight: 700; color: var(--text-bright); line-height: 1; margin-bottom: 6px; }
  .stat-label { font-size: 11px; color: var(--text-dim); letter-spacing: 1px; text-transform: uppercase; }
  .stat-icon { position: absolute; top: 16px; right: 16px; width: 40px; height: 40px; background: var(--neon-dim); border: 1px solid var(--border); border-radius: 8px; display: flex; align-items: center; justify-content: center; color: var(--neon); }
  .stat-trend { font-size: 11px; color: var(--text-dim); margin-top: 8px; }

  /* ===== TABLE ===== */
  .table-wrapper { overflow-x: auto; border-radius: 8px; border: 1px solid var(--border); }
  table { width: 100%; border-collapse: collapse; }
  thead tr { background: rgba(255,255,255,0.03); border-bottom: 1px solid var(--border); }
  th { padding: 12px 16px; font-size: 10px; font-weight: 600; letter-spacing: 2px; color: var(--neon); text-transform: uppercase; text-align: left; white-space: nowrap; }
  tbody tr { border-bottom: 1px solid rgba(255,255,255,0.04); transition: background 0.2s; }
  tbody tr:hover { background: var(--neon-dim); }
  td { padding: 12px 16px; font-size: 13px; color: var(--text); white-space: nowrap; }
  .badge { display: inline-block; padding: 3px 10px; border-radius: 20px; font-size: 10px; font-weight: 600; letter-spacing: 1px; text-transform: uppercase; }
  .badge-green { background: rgba(200,255,0,0.1); color: var(--neon); border: 1px solid rgba(200,255,0,0.3); }
  .badge-yellow { background: rgba(255,170,0,0.1); color: var(--warning); border: 1px solid rgba(255,170,0,0.3); }
  .badge-red { background: rgba(255,61,85,0.1); color: var(--danger); border: 1px solid rgba(255,61,85,0.3); }
  .badge-blue { background: rgba(77,184,255,0.1); color: var(--info); border: 1px solid rgba(77,184,255,0.3); }

  /* ===== FORM ===== */
  .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 16px; }
  .form-group { display: flex; flex-direction: column; gap: 6px; }
  label { font-size: 11px; font-weight: 600; letter-spacing: 1px; color: var(--text); text-transform: uppercase; }
  input, select, textarea { background: var(--bg4); border: 1px solid var(--border); border-radius: 6px; padding: 10px 14px; color: var(--text-bright); font-family: 'Josefin Sans', sans-serif; font-size: 13px; outline: none; transition: all 0.2s; width: 100%; }
  input:focus, select:focus, textarea:focus { border-color: var(--neon); box-shadow: 0 0 0 2px rgba(200,255,0,0.12); }
  textarea { resize: vertical; min-height: 80px; }
  select:disabled { opacity: 0.35; cursor: not-allowed; }

  /* ===== TOOLBAR ===== */
  .toolbar { display: flex; align-items: center; gap: 12px; margin-bottom: 16px; flex-wrap: wrap; }
  .toolbar h2 { font-size: 14px; font-weight: 700; color: var(--text-bright); letter-spacing: 2px; flex: 1; }
  .search-bar { position: relative; width: 260px; }
  .search-bar input { padding-left: 36px; width: 100%; }
  .search-bar svg { position: absolute; left: 10px; top: 50%; transform: translateY(-50%); color: var(--text-dim); width: 16px; height: 16px; }

  /* ===== DASHBOARD SPECIFIC & OTHERS ===== */
  .dashboard-grid { display: grid; grid-template-columns: 1fr 340px; gap: 20px; }
  .progress-bar-wrap { height: 6px; background: rgba(255,255,255,0.06); border-radius: 3px; overflow: hidden; margin-top: 6px; }
  .progress-bar-fill { height: 100%; background: var(--neon); border-radius: 3px; transition: width 1s cubic-bezier(.22,1,.36,1); }
  ::-webkit-scrollbar { width: 6px; height: 6px; }
  ::-webkit-scrollbar-track { background: var(--bg2); }
  ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }
  ::-webkit-scrollbar-thumb:hover { background: var(--neon); }

  /* Action buttons in table */
  .action-btns { display: flex; gap: 6px; }
  .icon-btn { width: 28px; height: 28px; display: flex; align-items: center; justify-content: center; border-radius: 6px; border: 1px solid var(--border); background: transparent; color: var(--text-dim); cursor: pointer; transition: all 0.2s; }
  .icon-btn:hover.edit { border-color: var(--info); color: var(--info); background: rgba(77,184,255,0.08); }
  .icon-btn:hover.delete { border-color: var(--danger); color: var(--danger); background: rgba(255,61,85,0.08); }
  .icon-btn:hover.view { border-color: var(--neon); color: var(--neon); background: var(--neon-dim); }

  /* Toast */
  #toast { position: fixed; bottom: 24px; right: 24px; background: var(--bg3); border: 1px solid var(--neon); border-radius: 10px; padding: 14px 20px; color: var(--neon); font-size: 13px; font-weight: 600; letter-spacing: 0.5px; z-index: 9999; transform: translateX(200%); transition: transform 0.4s cubic-bezier(.34,1.56,.64,1); display: flex; align-items: center; gap: 10px; }
  #toast.show { transform: translateX(0); }

  /* Responsive */
  @media (max-width: 768px) {
    .dashboard-grid { grid-template-columns: 1fr; }
    .stats-grid { grid-template-columns: repeat(2, 1fr); }
    .toolbar h2 { width: 100%; flex: none; }
  }
</style>
</head>
<body>

<div id="login-overlay">
  <div class="login-box">
    <h1>SIKANDA</h1>
    <p>Sistem Informasi Pengendalian & Penanganan Sengketa<br>Kanwil BPN Provinsi NTB</p>
    <input type="password" id="login-pwd" placeholder="Masukkan Password" onkeypress="if(event.key==='Enter') verifyLogin()">
    <button class="btn btn-primary" style="width:100%; justify-content:center; padding:12px;" onclick="verifyLogin()">LOGIN SISTEM</button>
    <div id="login-error" style="color:var(--danger); font-size:11px; margin-top:10px; opacity:0; transition:0.3s;">Password salah! Gunakan: admin</div>
  </div>
</div>

<nav id="sidebar">
  <div class="sidebar-header">
    <div class="logo-mark">
      <div class="logo-icon">BPN</div>
      <div class="logo-text">
        <div class="logo-title">SIKANDA</div>
        <div class="logo-sub">KANWIL BPN PROV. NTB<br>BIDANG PPSEN</div>
      </div>
    </div>
    <button id="collapse-btn" onclick="toggleSidebar()" title="Tutup/Buka Sidebar">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"/></svg>
    </button>
  </div>
  <div class="sidebar-nav">
    <div class="nav-section-label">UTAMA</div>
    <div class="nav-item active" data-label="Dashboard" onclick="navigateTo('dashboard', this)">
      <div class="nav-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg></div>
      <span class="nav-label">Dashboard</span>
    </div>
    <div class="nav-section-label">SURAT</div>
    <div class="nav-item" data-label="Surat Masuk" onclick="navigateTo('surat-masuk', this)">
      <div class="nav-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07A19.5 19.5 0 013 4.18 2 2 0 014.98 2h3a2 2 0 012 1.72 12.84 12.84 0 00.7 2.81 2 2 0 01-.45 2.11L9.09 9.91a16 16 0 006 6l1.27-1.27a2 2 0 012.11-.45 12.84 12.84 0 002.81.7A2 2 0 0122 16.92z"/></svg></div>
      <span class="nav-label">Surat Masuk</span>
      <span class="nav-badge" id="badge-masuk">0</span>
    </div>
    <div class="nav-item" data-label="Surat Keluar" onclick="navigateTo('surat-keluar', this)">
      <div class="nav-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg></div>
      <span class="nav-label">Surat Keluar</span>
      <span class="nav-badge" id="badge-keluar">0</span>
    </div>
    <div class="nav-section-label">PEMBATALAN</div>
    <div class="nav-item" data-label="Permohonan Pembatalan" onclick="navigateTo('pembatalan', this)">
      <div class="nav-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="4.93" y1="4.93" x2="19.07" y2="19.07"/></svg></div>
      <span class="nav-label">Permohonan Pembatalan</span>
    </div>
    <div class="nav-section-label">PERKARA & SENGKETA</div>
    <div class="nav-item" data-label="Penanganan Perkara" onclick="navigateTo('perkara', this)">
      <div class="nav-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="2" x2="12" y2="22"/><path d="M12 2L5 7l-3 7h6l-3-7"/><path d="M12 2l7 5 3 7h-6l3-7"/><line x1="5" y1="21" x2="19" y2="21"/><path d="M5 14a4 4 0 0 0 6 0"/><path d="M13 14a4 4 0 0 0 6 0"/></svg></div>
      <span class="nav-label">Penanganan Perkara</span>
    </div>
    <div class="nav-item" data-label="Penanganan Sengketa" onclick="navigateTo('sengketa', this)">
      <div class="nav-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 00-3-3.87"/><path d="M16 3.13a4 4 0 010 7.75"/></svg></div>
      <span class="nav-label">Penanganan Sengketa</span>
    </div>
    <div class="nav-section-label">PIDANA</div>
    <div class="nav-item" data-label="Tindak Pidana Pertanahan" onclick="navigateTo('tipidana', this)">
      <div class="nav-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="7" cy="14" r="3"/><circle cx="17" cy="14" r="3"/><path d="M7 11V8a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v3"/><line x1="10" y1="14" x2="14" y2="14"/><path d="M4.5 14H4a2 2 0 0 1-2-2v-1a2 2 0 0 1 2-2h.5"/><path d="M19.5 14H20a2 2 0 0 0 2-2v-1a2 2 0 0 0-2-2h-.5"/></svg></div>
      <span class="nav-label">Tindak Pidana Pertanahan</span>
    </div>
  </div>
  <div class="sidebar-footer">
    <div class="user-card">
      <div class="user-avatar">AD</div>
      <div class="user-info">
        <div class="user-name">Administrator</div>
        <div class="user-role">Kepala Bidang PPSEN</div>
      </div>
    </div>
  </div>
</nav>

<header id="header">
  <button id="back-btn" onclick="goBack()" title="Kembali ke halaman sebelumnya">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"/></svg>
  </button>
  <div>
    <div class="page-title" id="page-title">DASHBOARD</div>
    <div class="breadcrumb" id="breadcrumb">Beranda / Dashboard</div>
  </div>
  <div class="header-right">
    <div class="header-clock" id="clock">--:--:--</div>
    <button class="btn btn-danger" onclick="logout()" title="Keluar dari Sistem">LOGOUT</button>
  </div>
</header>

<main id="main">
  <div class="page active" id="page-dashboard">
    <div class="stats-grid">
      <div class="stat-card" onclick="navigateToWithNav('surat-masuk')">
        <div class="stat-value" id="stat-masuk">0</div>
        <div class="stat-label">Surat Masuk</div>
        <div class="stat-icon"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07A19.5 19.5 0 013 4.18 2 2 0 014.98 2h3a2 2 0 012 1.72 12.84 12.84 0 00.7 2.81 2 2 0 01-.45 2.11L9.09 9.91a16 16 0 006 6l1.27-1.27a2 2 0 012.11-.45 12.84 12.84 0 002.81.7A2 2 0 0122 16.92z"/></svg></div>
      </div>
      <div class="stat-card" onclick="navigateToWithNav('surat-keluar')">
        <div class="stat-value" id="stat-keluar">0</div>
        <div class="stat-label">Surat Keluar</div>
        <div class="stat-icon"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg></div>
      </div>
      <div class="stat-card" onclick="navigateToWithNav('pembatalan')">
        <div class="stat-value" id="stat-pembatalan">0</div>
        <div class="stat-label">Permohonan Pembatalan</div>
        <div class="stat-icon" style="color:var(--warning)"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="4.93" y1="4.93" x2="19.07" y2="19.07"/></svg></div>
      </div>
      <div class="stat-card" onclick="navigateToWithNav('perkara')">
        <div class="stat-value" id="stat-perkara">0</div>
        <div class="stat-label">Penanganan Perkara</div>
        <div class="stat-icon" style="color:var(--danger)"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="2" x2="12" y2="22"/><path d="M12 2L5 7l-3 7h6l-3-7"/><path d="M12 2l7 5 3 7h-6l3-7"/><line x1="5" y1="21" x2="19" y2="21"/><path d="M5 14a4 4 0 0 0 6 0"/><path d="M13 14a4 4 0 0 0 6 0"/></svg></div>
      </div>
      <div class="stat-card" onclick="navigateToWithNav('sengketa')">
        <div class="stat-value" id="stat-sengketa">0</div>
        <div class="stat-label">Penanganan Sengketa</div>
        <div class="stat-icon" style="color:var(--info)"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 00-3-3.87"/><path d="M16 3.13a4 4 0 010 7.75"/></svg></div>
      </div>
      <div class="stat-card" onclick="navigateToWithNav('tipidana')">
        <div class="stat-value" id="stat-tipidana">0</div>
        <div class="stat-label">Tindak Pidana Pertanahan</div>
        <div class="stat-icon" style="color:var(--danger)"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="7" cy="14" r="3"/><circle cx="17" cy="14" r="3"/><path d="M7 11V8a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v3"/><line x1="10" y1="14" x2="14" y2="14"/><path d="M4.5 14H4a2 2 0 0 1-2-2v-1a2 2 0 0 1 2-2h.5"/><path d="M19.5 14H20a2 2 0 0 0 2-2v-1a2 2 0 0 0-2-2h-.5"/></svg></div>
      </div>
    </div>
  </div>

  <div class="page" id="page-surat-masuk">
    <div class="toolbar">
      <h2>SURAT MASUK</h2>
      <div class="search-bar"><input type="text" placeholder="Cari surat masuk..." oninput="filterTable('tbl-masuk', this.value)"></div>
      <button class="btn btn-export" onclick="exportCSV('masuk')">EXPORT CSV</button>
      <button class="btn btn-primary" onclick="showAddForm('surat-masuk')">TAMBAH</button>
    </div>
    <div class="card" id="form-surat-masuk" style="display:none; margin-bottom:20px;">
      <div class="card-title">FORM INPUT SURAT MASUK</div>
      <div class="form-grid">
        <div class="form-group"><label>Nomor Surat *</label><input type="text" id="sm-nomor" required></div>
        <div class="form-group"><label>Tanggal Terima *</label><input type="date" id="sm-tanggal" required></div>
        <div class="form-group"><label>Asal Surat *</label><input type="text" id="sm-asal" required></div>
        <div class="form-group"><label>Perihal *</label><input type="text" id="sm-perihal" required></div>
        <div class="form-group"><label>Status</label><select id="sm-status"><option value="Diterima">Diterima</option><option value="Diproses">Diproses</option><option value="Selesai">Selesai</option></select></div>
        <div class="form-group"><label>Disposisi</label><input type="text" id="sm-disposisi"></div>
      </div>
      <div style="margin-top:16px;display:flex;gap:10px;justify-content:flex-end;">
        <button class="btn btn-ghost" onclick="hideForm('form-surat-masuk')">BATAL</button>
        <button class="btn btn-primary" onclick="addSuratMasuk()">SIMPAN</button>
      </div>
    </div>
    <div class="card"><div class="table-wrapper"><table id="tbl-masuk"><thead><tr><th>No</th><th>Nomor Surat</th><th>Tgl Terima</th><th>Asal Surat</th><th>Perihal</th><th>Status</th><th>Disposisi</th><th>Aksi</th></tr></thead><tbody id="tbody-masuk"></tbody></table></div></div>
  </div>

  <div class="page" id="page-surat-keluar">
    <div class="toolbar">
      <h2>SURAT KELUAR</h2>
      <div class="search-bar"><input type="text" placeholder="Cari surat keluar..." oninput="filterTable('tbl-keluar', this.value)"></div>
      <button class="btn btn-export" onclick="exportCSV('keluar')">EXPORT CSV</button>
      <button class="btn btn-primary" onclick="showAddForm('surat-keluar')">TAMBAH</button>
    </div>
    <div class="card" id="form-surat-keluar" style="display:none; margin-bottom:20px;">
      <div class="card-title">FORM INPUT SURAT KELUAR</div>
      <div class="form-grid">
        <div class="form-group"><label>Nomor Surat *</label><input type="text" id="sk-nomor" required></div>
        <div class="form-group"><label>Tanggal Surat *</label><input type="date" id="sk-tanggal" required></div>
        <div class="form-group"><label>Ditujukan Kepada *</label><input type="text" id="sk-tujuan" required></div>
        <div class="form-group"><label>Perihal *</label><input type="text" id="sk-perihal" required></div>
        <div class="form-group"><label>Penandatangan *</label><input type="text" id="sk-ttd" required></div>
        <div class="form-group"><label>Status</label><select id="sk-status"><option value="Terkirim">Terkirim</option><option value="Draf">Draf</option></select></div>
      </div>
      <div style="margin-top:16px;display:flex;gap:10px;justify-content:flex-end;">
        <button class="btn btn-ghost" onclick="hideForm('form-surat-keluar')">BATAL</button>
        <button class="btn btn-primary" onclick="addSuratKeluar()">SIMPAN</button>
      </div>
    </div>
    <div class="card"><div class="table-wrapper"><table id="tbl-keluar"><thead><tr><th>No</th><th>Nomor Surat</th><th>Tanggal</th><th>Ditujukan Kepada</th><th>Perihal</th><th>Penandatangan</th><th>Status</th><th>Aksi</th></tr></thead><tbody id="tbody-keluar"></tbody></table></div></div>
  </div>

  <div class="page" id="page-pembatalan">
    <div class="toolbar">
      <h2>PERMOHONAN PEMBATALAN</h2>
      <div class="search-bar"><input type="text" placeholder="Cari permohonan..." oninput="filterTable('tbl-pembatalan', this.value)"></div>
      <button class="btn btn-export" onclick="exportCSV('pembatalan')">EXPORT CSV</button>
      <button class="btn btn-primary" onclick="showAddForm('pembatalan')">TAMBAH</button>
    </div>
    <div class="card" id="form-pembatalan" style="display:none; margin-bottom:20px;">
      <div class="card-title">FORM PERMOHONAN PEMBATALAN</div>
      <div class="form-grid">
        <div class="form-group"><label>Nomor Berkas *</label><input type="text" id="pmb-nomor" required></div>
        <div class="form-group"><label>Tanggal Permohonan *</label><input type="date" id="pmb-tanggal" required></div>
        <div class="form-group"><label>Nama Pemohon *</label><input type="text" id="pmb-pemohon" required></div>
        <div class="form-group"><label>Objek Permohonan *</label><input type="text" id="pmb-objek" required></div>
        <div class="form-group"><label>Alasan Pembatalan</label><select id="pmb-alasan"><option value="Cacat Administrasi">Cacat Administrasi</option><option value="Putusan Pengadilan">Putusan Pengadilan</option><option value="Tumpang Tindih">Tumpang Tindih</option></select></div>
        <div class="form-group"><label>Status</label><select id="pmb-status"><option value="Baru">Baru</option><option value="Diproses">Diproses</option><option value="Selesai">Selesai</option><option value="Ditolak">Ditolak</option></select></div>
      </div>
      <div style="margin-top:16px;display:flex;gap:10px;justify-content:flex-end;">
        <button class="btn btn-ghost" onclick="hideForm('form-pembatalan')">BATAL</button>
        <button class="btn btn-primary" onclick="addPembatalan()">SIMPAN</button>
      </div>
    </div>
    <div class="card"><div class="table-wrapper"><table id="tbl-pembatalan"><thead><tr><th>No</th><th>Nomor Berkas</th><th>Tgl Permohonan</th><th>Pemohon</th><th>Objek</th><th>Alasan</th><th>Status</th><th>Aksi</th></tr></thead><tbody id="tbody-pembatalan"></tbody></table></div></div>
  </div>

  <div class="page" id="page-perkara">
    <div class="toolbar">
      <h2>PENANGANAN PERKARA</h2>
      <div class="search-bar"><input type="text" placeholder="Cari perkara..." oninput="filterTable('tbl-perkara', this.value)"></div>
      <button class="btn btn-export" onclick="exportCSV('perkara')">EXPORT CSV</button>
      <button class="btn btn-primary" onclick="showAddForm('perkara')">TAMBAH</button>
    </div>
    <div class="card" id="form-perkara" style="display:none; margin-bottom:20px;">
      <div class="card-title">FORM PENANGANAN PERKARA</div>
      <div class="form-grid">
        <div class="form-group"><label>Nomor Perkara *</label><input type="text" id="prk-nomor" required></div>
        <div class="form-group"><label>Tanggal Masuk *</label><input type="date" id="prk-tanggal" required></div>
        <div class="form-group"><label>Penggugat *</label><input type="text" id="prk-penggugat" required></div>
        <div class="form-group"><label>Tergugat *</label><input type="text" id="prk-tergugat" required></div>
        <div class="form-group"><label>Nomor Register</label><input type="text" id="prk-register"></div>
        <div class="form-group"><label>Pengadilan</label><input type="text" id="prk-pengadilan"></div>
        <div class="form-group"><label>Status</label><select id="prk-status"><option value="Aktif">Aktif</option><option value="Banding">Banding</option><option value="Kasasi">Kasasi</option><option value="Inkracht">Inkracht</option><option value="Selesai">Selesai</option></select></div>
      </div>
      <div style="margin-top:16px;display:flex;gap:10px;justify-content:flex-end;">
        <button class="btn btn-ghost" onclick="hideForm('form-perkara')">BATAL</button>
        <button class="btn btn-primary" onclick="addPerkara()">SIMPAN</button>
      </div>
    </div>
    <div class="card"><div class="table-wrapper"><table id="tbl-perkara"><thead><tr><th>No</th><th>No Perkara</th><th>Tgl Masuk</th><th>Penggugat</th><th>Tergugat</th><th>No. Register</th><th>Pengadilan</th><th>Status</th><th>Aksi</th></tr></thead><tbody id="tbody-perkara"></tbody></table></div></div>
  </div>

  <div class="page" id="page-sengketa">
    <div class="toolbar">
      <h2>PENANGANAN SENGKETA</h2>
      <div class="search-bar"><input type="text" placeholder="Cari sengketa..." oninput="filterTable('tbl-sengketa', this.value)"></div>
      <button class="btn btn-export" onclick="exportCSV('sengketa')">EXPORT CSV</button>
      <button class="btn btn-primary" onclick="showAddForm('sengketa')">TAMBAH</button>
    </div>
    <div class="card" id="form-sengketa" style="display:none; margin-bottom:20px;">
      <div class="card-title">FORM PENANGANAN SENGKETA</div>
      <div class="form-grid">
        <div class="form-group"><label>Nomor Sengketa *</label><input type="text" id="sng-nomor" required></div>
        <div class="form-group"><label>Tanggal Masuk *</label><input type="date" id="sng-tanggal" required></div>
        <div class="form-group"><label>Pemohon *</label><input type="text" id="sng-pemohon" required></div>
        <div class="form-group"><label>Terlapor *</label><input type="text" id="sng-terlapor" required></div>
        <div class="form-group"><label>Objek Sengketa</label><input type="text" id="sng-objek"></div>
        <div class="form-group"><label>Jenis Sengketa</label><select id="sng-jenis"><option value="Tumpang Tindih Sertipikat">Tumpang Tindih</option><option value="Penguasaan Tanah">Penguasaan</option><option value="Batas Bidang Tanah">Batas</option></select></div>
        <div class="form-group"><label>Status</label><select id="sng-status"><option value="Mediasi">Mediasi</option><option value="Gelar Kasus">Gelar Kasus</option><option value="Penyelidikan">Penyelidikan</option><option value="Selesai">Selesai</option></select></div>
      </div>
      <div style="margin-top:16px;display:flex;gap:10px;justify-content:flex-end;">
        <button class="btn btn-ghost" onclick="hideForm('form-sengketa')">BATAL</button>
        <button class="btn btn-primary" onclick="addSengketa()">SIMPAN</button>
      </div>
    </div>
    <div class="card"><div class="table-wrapper"><table id="tbl-sengketa"><thead><tr><th>No</th><th>No Sengketa</th><th>Tgl Masuk</th><th>Pemohon</th><th>Terlapor</th><th>Objek</th><th>Jenis</th><th>Status</th><th>Aksi</th></tr></thead><tbody id="tbody-sengketa"></tbody></table></div></div>
  </div>

  <div class="page" id="page-tipidana">
    <div class="toolbar">
      <h2>TINDAK PIDANA PERTANAHAN</h2>
      <div class="search-bar"><input type="text" placeholder="Cari kasus..." oninput="filterTable('tbl-tipidana', this.value)"></div>
      <button class="btn btn-export" onclick="exportCSV('tipidana')">EXPORT CSV</button>
      <button class="btn btn-primary" onclick="showAddForm('tipidana')">TAMBAH</button>
    </div>
    <div class="card" id="form-tipidana" style="display:none; margin-bottom:20px;">
      <div class="card-title">FORM TINDAK PIDANA PERTANAHAN</div>
      <div class="form-grid">
        <div class="form-group"><label>Nomor Kasus *</label><input type="text" id="tpa-nomor" required></div>
        <div class="form-group"><label>Tanggal Laporan *</label><input type="date" id="tpa-tanggal" required></div>
        <div class="form-group"><label>Tersangka *</label><input type="text" id="tpa-tersangka" required></div>
        <div class="form-group"><label>Jenis Tindak Pidana</label><select id="tpa-jenis"><option value="Pemalsuan Sertipikat">Pemalsuan</option><option value="Penipuan Jual Beli Tanah">Penipuan</option><option value="Pendudukan Tanah Tanpa Hak">Pendudukan</option></select></div>
        <div class="form-group"><label>Pasal</label><input type="text" id="tpa-pasal"></div>
        <div class="form-group"><label>Instansi</label><input type="text" id="tpa-instansi"></div>
        <div class="form-group"><label>Status</label><select id="tpa-status"><option value="Laporan">Laporan</option><option value="Penyelidikan">Penyelidikan</option><option value="Penyidikan">Penyidikan</option><option value="P21">P21</option><option value="Selesai">Selesai</option></select></div>
      </div>
      <div style="margin-top:16px;display:flex;gap:10px;justify-content:flex-end;">
        <button class="btn btn-ghost" onclick="hideForm('form-tipidana')">BATAL</button>
        <button class="btn btn-primary" onclick="addTipidana()">SIMPAN</button>
      </div>
    </div>
    <div class="card"><div class="table-wrapper"><table id="tbl-tipidana"><thead><tr><th>No</th><th>No Kasus</th><th>Tgl Laporan</th><th>Tersangka</th><th>Jenis Pidana</th><th>Pasal</th><th>Instansi</th><th>Status</th><th>Aksi</th></tr></thead><tbody id="tbody-tipidana"></tbody></table></div></div>
  </div>
</main>

<div id="toast">
  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
  <span id="toast-msg">Sukses</span>
</div>

<script>
// ==============================
// 1. SISTEM LOGIN & AUTENTIKASI (Mockup)
// ==============================
function checkLogin() {
  const isLogged = sessionStorage.getItem('sikanda_logged');
  if(isLogged === 'true') {
    document.getElementById('login-overlay').style.display = 'none';
  }
}
function login() {
  const pwd = document.getElementById('login-pwd').value;
  if(pwd === 'admin') {
    sessionStorage.setItem('sikanda_logged', 'true');
    document.getElementById('login-overlay').style.opacity = '0';
    setTimeout(() => document.getElementById('login-overlay').style.display = 'none', 500);
  } else {
    document.getElementById('login-error').style.opacity = '1';
  }
}
function verifyLogin() { login(); }
function logout() {
  sessionStorage.removeItem('sikanda_logged');
  location.reload();
}

// ==============================
// 2. LOCAL STORAGE (Data Persistence)
// ==============================
let DB = JSON.parse(localStorage.getItem('sikanda_db'));

// Default Data jika baru pertama kali buka
if (!DB) {
  DB = {
    suratMasuk: [
      { id:1, nomor:'021/SM/II/2025', tanggal:'2025-02-21', asal:'Kantor ATR/BPN Lombok Barat', perihal:'Sengketa HM No.123 Desa Gapuk', status:'Diterima', disposisi:'Kabid PPSEN' }
    ],
    suratKeluar: [], pembatalan: [], perkara: [], sengketa: [], tipidana: [], calendarEvents: {}
  };
  saveDB();
}

function saveDB() {
  localStorage.setItem('sikanda_db', JSON.stringify(DB));
  updateStats();
}

// ==============================
// NAVIGATION & UI
// ==============================
function navigateTo(pageId, navEl) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.getElementById('page-' + pageId).classList.add('active');
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  if (navEl) navEl.classList.add('active');
  
  if (pageId !== 'dashboard') renderTable(pageId.replace('surat-', ''));
}
function navigateToWithNav(pageId) {
  const navItems = document.querySelectorAll('.nav-item');
  navItems.forEach(item => { if (item.getAttribute('onclick').includes(`'${pageId}'`)) navigateTo(pageId, item); });
}
function toggleSidebar() { document.getElementById('sidebar').classList.toggle('collapsed'); }

function updateClock() {
  const now = new Date();
  document.getElementById('clock').textContent = now.toLocaleTimeString('id-ID');
}
setInterval(updateClock, 1000); updateClock();

// ==============================
// TABLES & FORMS
// ==============================
function getBadgeClass(status) {
  const map = { 'Diterima':'badge-blue', 'Diproses':'badge-yellow', 'Selesai':'badge-green', 'Ditolak':'badge-red', 'Terkirim':'badge-green', 'Draf':'badge-yellow', 'Baru':'badge-blue', 'Aktif':'badge-blue', 'Penyidikan':'badge-yellow', 'P21':'badge-green' };
  return map[status] || 'badge-blue';
}

function renderTable(type) {
  const configs = {
    masuk: { data: DB.suratMasuk, tbody: 'tbody-masuk', cols: ['nomor','tanggal','asal','perihal','status','disposisi'] },
    keluar: { data: DB.suratKeluar, tbody: 'tbody-keluar', cols: ['nomor','tanggal','tujuan','perihal','ttd','status'] },
    pembatalan: { data: DB.pembatalan, tbody: 'tbody-pembatalan', cols: ['nomor','tanggal','pemohon','objek','alasan','status'] },
    perkara: { data: DB.perkara, tbody: 'tbody-perkara', cols: ['nomor','tanggal','penggugat','tergugat','register','pengadilan','status'] },
    sengketa: { data: DB.sengketa, tbody: 'tbody-sengketa', cols: ['nomor','tanggal','pemohon','terlapor','objek','jenis','status'] },
    tipidana: { data: DB.tipidana, tbody: 'tbody-tipidana', cols: ['nomor','tanggal','tersangka','jenis','pasal','instansi','status'] },
  };
  const cfg = configs[type];
  if (!cfg) return;
  const tbody = document.getElementById(cfg.tbody);
  tbody.innerHTML = '';
  cfg.data.forEach((row, i) => {
    let cells = `<td>${i+1}</td>`;
    cfg.cols.forEach(col => { cells += col === 'status' ? `<td><span class="badge ${getBadgeClass(row[col])}">${row[col]}</span></td>` : `<td>${row[col]||'-'}</td>`; });
    cells += `<td><button class="icon-btn delete" onclick="deleteRecord('${type}',${row.id})"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14H6L5 6"/></svg></button></td>`;
    const tr = document.createElement('tr'); tr.innerHTML = cells; tbody.appendChild(tr);
  });
}

function showAddForm(id) { document.getElementById('form-'+id).style.display = 'block'; }
function hideForm(id) { document.getElementById(id).style.display = 'none'; }
function filterTable(tableId, query) {
  const rows = document.querySelectorAll(`#${tableId} tbody tr`);
  rows.forEach(row => row.style.display = row.textContent.toLowerCase().includes(query.toLowerCase()) ? '' : 'none');
}
function deleteRecord(type, id) {
  const map = { masuk:'suratMasuk', keluar:'suratKeluar', pembatalan:'pembatalan', perkara:'perkara', sengketa:'sengketa', tipidana:'tipidana' };
  DB[map[type]] = DB[map[type]].filter(r => r.id !== id);
  saveDB(); renderTable(type); showToast('Data dihapus!');
}

function getNextId(arr) { return arr.length ? Math.max(...arr.map(r => r.id)) + 1 : 1; }

// Tambah Data Fungsi (Contoh diringkas untuk Surat Masuk)
function addSuratMasuk() {
  const nomor = document.getElementById('sm-nomor').value, tanggal = document.getElementById('sm-tanggal').value, asal = document.getElementById('sm-asal').value, perihal = document.getElementById('sm-perihal').value;
  if(!nomor || !tanggal || !asal || !perihal) { showToast('Isi field wajib (*)', true); return; }
  DB.suratMasuk.unshift({ id: getNextId(DB.suratMasuk), nomor, tanggal, asal, perihal, status: document.getElementById('sm-status').value, disposisi: document.getElementById('sm-disposisi').value });
  saveDB(); renderTable('masuk'); hideForm('form-surat-masuk'); showToast('Tersimpan!');
}
function addSuratKeluar() {
  const nomor = document.getElementById('sk-nomor').value, tanggal = document.getElementById('sk-tanggal').value, tujuan = document.getElementById('sk-tujuan').value, perihal = document.getElementById('sk-perihal').value, ttd = document.getElementById('sk-ttd').value;
  if(!nomor || !tanggal || !tujuan || !perihal || !ttd) { showToast('Isi field wajib (*)', true); return; }
  DB.suratKeluar.unshift({ id: getNextId(DB.suratKeluar), nomor, tanggal, tujuan, perihal, ttd, status: document.getElementById('sk-status').value });
  saveDB(); renderTable('keluar'); hideForm('form-surat-keluar'); showToast('Tersimpan!');
}
function addPembatalan() {
  const nomor = document.getElementById('pmb-nomor').value, tanggal = document.getElementById('pmb-tanggal').value, pemohon = document.getElementById('pmb-pemohon').value, objek = document.getElementById('pmb-objek').value;
  if(!nomor || !tanggal || !pemohon || !objek) { showToast('Isi field wajib (*)', true); return; }
  DB.pembatalan.unshift({ id: getNextId(DB.pembatalan), nomor, tanggal, pemohon, objek, alasan: document.getElementById('pmb-alasan').value, status: document.getElementById('pmb-status').value });
  saveDB(); renderTable('pembatalan'); hideForm('form-pembatalan'); showToast('Tersimpan!');
}
function addPerkara() {
  const nomor = document.getElementById('prk-nomor').value, tanggal = document.getElementById('prk-tanggal').value, penggugat = document.getElementById('prk-penggugat').value, tergugat = document.getElementById('prk-tergugat').value;
  if(!nomor || !tanggal || !penggugat || !tergugat) { showToast('Isi field wajib (*)', true); return; }
  DB.perkara.unshift({ id: getNextId(DB.perkara), nomor, tanggal, penggugat, tergugat, register: document.getElementById('prk-register').value, pengadilan: document.getElementById('prk-pengadilan').value, status: document.getElementById('prk-status').value });
  saveDB(); renderTable('perkara'); hideForm('form-perkara'); showToast('Tersimpan!');
}
function addSengketa() {
  const nomor = document.getElementById('sng-nomor').value, tanggal = document.getElementById('sng-tanggal').value, pemohon = document.getElementById('sng-pemohon').value, terlapor = document.getElementById('sng-terlapor').value;
  if(!nomor || !tanggal || !pemohon || !terlapor) { showToast('Isi field wajib (*)', true); return; }
  DB.sengketa.unshift({ id: getNextId(DB.sengketa), nomor, tanggal, pemohon, terlapor, objek: document.getElementById('sng-objek').value, jenis: document.getElementById('sng-jenis').value, status: document.getElementById('sng-status').value });
  saveDB(); renderTable('sengketa'); hideForm('form-sengketa'); showToast('Tersimpan!');
}
function addTipidana() {
  const nomor = document.getElementById('tpa-nomor').value, tanggal = document.getElementById('tpa-tanggal').value, tersangka = document.getElementById('tpa-tersangka').value;
  if(!nomor || !tanggal || !tersangka) { showToast('Isi field wajib (*)', true); return; }
  DB.tipidana.unshift({ id: getNextId(DB.tipidana), nomor, tanggal, tersangka, jenis: document.getElementById('tpa-jenis').value, pasal: document.getElementById('tpa-pasal').value, instansi: document.getElementById('tpa-instansi').value, status: document.getElementById('tpa-status').value });
  saveDB(); renderTable('tipidana'); hideForm('form-tipidana'); showToast('Tersimpan!');
}

// ==============================
// 3. EXPORT KE CSV
// ==============================
function exportCSV(type) {
  const map = { masuk:'suratMasuk', keluar:'suratKeluar', pembatalan:'pembatalan', perkara:'perkara', sengketa:'sengketa', tipidana:'tipidana' };
  const data = DB[map[type]];
  if(data.length === 0) { showToast('Data kosong', true); return; }
  
  const headers = Object.keys(data[0]).filter(k => k !== 'id');
  let csvContent = "data:text/csv;charset=utf-8," + headers.join(",") + "\n";
  
  data.forEach(row => {
    let rowData = headers.map(header => `"${row[header] || ''}"`).join(",");
    csvContent += rowData + "\n";
  });
  
  const encodedUri = encodeURI(csvContent);
  const link = document.createElement("a");
  link.setAttribute("href", encodedUri);
  link.setAttribute("download", `SIKANDA_${type}_${new Date().toISOString().split('T')[0]}.csv`);
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
  showToast('Berhasil diekspor ke CSV!');
}

function updateStats() {
  document.getElementById('stat-masuk').textContent = DB.suratMasuk.length;
  document.getElementById('stat-keluar').textContent = DB.suratKeluar.length;
  document.getElementById('stat-pembatalan').textContent = DB.pembatalan.length;
  document.getElementById('stat-perkara').textContent = DB.perkara.length;
  document.getElementById('stat-sengketa').textContent = DB.sengketa.length;
  document.getElementById('stat-tipidana').textContent = DB.tipidana.length;
  
  // Update Badges Dynamically
  document.getElementById('badge-masuk').textContent = DB.suratMasuk.filter(s => s.status === 'Diterima' || s.status === 'Diproses').length;
  document.getElementById('badge-keluar').textContent = DB.suratKeluar.filter(s => s.status === 'Draf').length;
}

let toastTimer;
function showToast(msg, isError = false) {
  const toast = document.getElementById('toast');
  document.getElementById('toast-msg').textContent = msg;
  toast.style.borderColor = isError ? 'var(--danger)' : 'var(--neon)';
  toast.style.color = isError ? 'var(--danger)' : 'var(--neon)';
  toast.classList.add('show');
  clearTimeout(toastTimer);
  toastTimer = setTimeout(() => toast.classList.remove('show'), 3000);
}

// Init
checkLogin(); updateStats();
</script>
</body>
</html>
