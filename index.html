<!DOCTYPE html>
<html lang="id">
<head>
  <div class="header-right">
  <div class="header-clock" id="clock">--:--:--</div>
  
  <button class="btn btn-ghost" onclick="toggleTheme()" title="Ubah Tema" style="padding: 7px 10px;">
    <svg id="theme-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
  </button>

  <button class="btn btn-danger" onclick="logout()" title="Keluar dari Sistem">
    LOGOUT
  </button>
</div>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SIKANDA - Kanwil BPN NTB | Bidang Pengendalian & Penanganan Sengketa</title>
<link href="https://fonts.googleapis.com/css2?family=Josefin+Sans:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;1,100;1,300;1,400&family=Share+Tech+Mono&display=swap" rel="stylesheet">
<style>
  :root {
    --neon: #c8ff00;
    --neon2: #b8eb00;
    --neon-dim: rgba(200,255,0,0.08);
    --bg: #0d0d0d;
    --bg2: #111111;
    --bg3: #161616;
    --bg4: #1a1a1a;
    --surface: rgba(20,20,20,0.97);
    --border: rgba(255,255,255,0.08);
    --border-bright: rgba(200,255,0,0.45);
    --text: #a0a0a0;
    --text-dim: #8a8a8a; /* Diperbaiki: Warna lebih terang agar kontras & mudah dibaca */
    --text-bright: #ffffff;
    --danger: #ff3d55;
    --warning: #ffaa00;
    --info: #4db8ff;
    --sidebar-w: 260px;
    --header-h: 64px;
  }
  /* ===== LIGHT MODE (MONOCHROME) ===== */
[data-theme="light"] {
  --neon: #1a1a1a; /* Warna aksen utama menjadi gelap/hitam */
  --neon2: #333333;
  --neon-dim: rgba(0, 0, 0, 0.04);
  --bg: #f4f4f5; /* Latar belakang abu-abu sangat terang */
  --bg2: #ffffff; /* Sidebar putih bersih */
  --bg3: #e4e4e7;
  --bg4: #ffffff;
  --surface: rgba(255, 255, 255, 0.98);
  --border: rgba(0, 0, 0, 0.1);
  --border-bright: rgba(0, 0, 0, 0.25);
  --text: #3f3f46;
  --text-dim: #71717a;
  --text-bright: #000000;
}

/* Membalikkan warna pattern grid background agar terlihat di Light Mode */
[data-theme="light"] body::before {
  background-image: linear-gradient(rgba(0,0,0,0.03) 1px, transparent 1px), linear-gradient(90deg, rgba(0,0,0,0.03) 1px, transparent 1px);
}
[data-theme="light"] body::after {
  background: radial-gradient(circle, rgba(0,0,0,0.03) 0%, transparent 70%);
}

/* Memastikan teks input terbaca dengan baik di Light Mode */
[data-theme="light"] input, 
[data-theme="light"] select, 
[data-theme="light"] textarea {
  background: #ffffff;
  color: #000000;
}
[data-theme="light"] .btn-primary {
  color: #ffffff; /* Teks tombol utama menjadi putih di atas latar hitam */
}

  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
  html { font-size: 14px; }
  body { font-family: 'Josefin Sans', sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; overflow-x: hidden; }

  /* Grid bg */
  body::before {
    content: ''; position: fixed; inset: 0; pointer-events: none; z-index: 0;
    background-image: linear-gradient(rgba(255,255,255,0.025) 1px, transparent 1px), linear-gradient(90deg, rgba(255,255,255,0.025) 1px, transparent 1px);
    background-size: 40px 40px;
  }
  body::after {
    content: ''; position: fixed; top: -40%; left: -20%; width: 600px; height: 600px;
    background: radial-gradient(circle, rgba(200,255,0,0.03) 0%, transparent 70%); pointer-events: none; z-index: 0;
  }

  /* ===== LOGIN OVERLAY ===== */
  #login-overlay {
    position: fixed; inset: 0; background: rgba(13,13,13,0.95); z-index: 99999;
    display: flex; align-items: center; justify-content: center;
    backdrop-filter: blur(10px); transition: opacity 0.5s ease;
  }
  .login-box {
    background: var(--surface); border: 1px solid var(--border-bright); padding: 40px; 
    border-radius: 16px; width: 100%; max-width: 400px; text-align: center; 
    box-shadow: 0 0 30px rgba(200,255,0,0.1); animation: fadeUp 0.5s ease forwards;
  }
  .login-box h1 { color: var(--neon); font-size: 24px; letter-spacing: 3px; margin-bottom: 10px; }
  .login-box p { color: var(--text-dim); margin-bottom: 30px; font-size: 12px; }
  .login-box input { width: 100%; padding: 12px; margin-bottom: 20px; text-align: center; letter-spacing: 2px; }

  /* ===== SIDEBAR ===== */
  #sidebar { position: fixed; left: 0; top: 0; bottom: 0; width: var(--sidebar-w); background: var(--bg2); border-right: 1px solid var(--border); z-index: 100; display: flex; flex-direction: column; overflow: hidden; transition: width 0.35s cubic-bezier(.77,0,.18,1); }
  #sidebar.collapsed { width: 64px; }
  .sidebar-header { padding: 16px 12px; border-bottom: 1px solid var(--border); flex-shrink: 0; display: flex; align-items: center; justify-content: space-between; gap: 8px; min-height: 64px; }
  #sidebar.collapsed .sidebar-header { justify-content: center; }
  .logo-mark { display: flex; align-items: center; gap: 12px; overflow: hidden; }
  .logo-icon { width: 36px; height: 36px; background: var(--neon); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-weight: 900; font-size: 14px; color: #000; flex-shrink: 0; }
  .logo-text { overflow: hidden; white-space: nowrap; }
  .logo-title { font-size: 13px; font-weight: 700; color: var(--neon); letter-spacing: 2px; }
  .logo-sub { font-size: 9px; color: var(--text-dim); letter-spacing: 1px; line-height: 1.4; margin-top: 2px; }
  
  .sidebar-nav { flex: 1; overflow-y: auto; overflow-x: visible; padding: 12px 8px; scrollbar-width: thin; scrollbar-color: var(--border) transparent; }
  #sidebar.collapsed .sidebar-nav { overflow: visible; }
  .nav-section-label { font-size: 9px; letter-spacing: 2px; color: var(--text-dim); padding: 8px 8px 4px; text-transform: uppercase; white-space: nowrap; transition: opacity 0.3s; }
  #sidebar.collapsed .nav-section-label { opacity: 0; }
  
  .nav-item { display: flex; align-items: center; gap: 12px; padding: 10px 12px; border-radius: 8px; cursor: pointer; margin-bottom: 2px; transition: all 0.2s ease; position: relative; overflow: hidden; white-space: nowrap; border: 1px solid transparent; }
  .nav-item:hover { background: var(--neon-dim); border-color: var(--border); color: var(--neon); }
  .nav-item.active { background: rgba(200,255,0,0.07); border-color: var(--border-bright); color: var(--neon); }
  .nav-item.active::before { content: ''; position: absolute; left: 0; top: 0; bottom: 0; width: 3px; background: var(--neon); }
  .nav-icon { width: 20px; height: 20px; flex-shrink: 0; display: flex; align-items: center; justify-content: center; }
  .nav-icon svg { width: 18px; height: 18px; }
  .nav-label { font-size: 13px; font-weight: 500; letter-spacing: 0.5px; overflow: hidden; text-overflow: ellipsis; }
  .nav-badge { margin-left: auto; background: var(--neon); color: #000; font-size: 10px; font-weight: 700; padding: 1px 6px; border-radius: 10px; flex-shrink: 0; }
  
  .sidebar-footer { padding: 12px; border-top: 1px solid var(--border); flex-shrink: 0; }
  .user-card { display: flex; align-items: center; gap: 10px; padding: 10px; border-radius: 8px; background: var(--neon-dim); border: 1px solid var(--border); overflow: hidden; }
  .user-avatar { width: 32px; height: 32px; border-radius: 50%; background: var(--neon); display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: 700; color: #000; flex-shrink: 0; }
  .user-info { overflow: hidden; }
  .user-name { font-size: 12px; font-weight: 600; color: var(--text-bright); white-space: nowrap; }
  .user-role { font-size: 10px; color: var(--text-dim); white-space: nowrap; }

  #collapse-btn { display: flex; align-items: center; justify-content: center; width: 32px; height: 32px; border-radius: 8px; border: 1px solid var(--border); background: transparent; color: var(--text-dim); cursor: pointer; transition: all 0.22s ease; flex-shrink: 0; }
  #collapse-btn:hover { background: var(--neon-dim); border-color: var(--border-bright); color: var(--neon); }
  #collapse-btn svg { width: 16px; height: 16px; transition: transform 0.35s cubic-bezier(.77,0,.18,1); }
  #sidebar.collapsed #collapse-btn svg { transform: rotate(180deg); }
  #sidebar.collapsed #collapse-btn { margin: 0 auto; }

  /* Tooltip for collapsed nav items */
  #sidebar.collapsed .nav-item { justify-content: center; }
  #sidebar.collapsed .nav-item::after {
    content: attr(data-label); position: absolute; left: calc(100% + 12px); top: 50%; transform: translateY(-50%);
    background: var(--bg3); border: 1px solid var(--border-bright); color: var(--text-bright); font-size: 11px;
    font-weight: 600; letter-spacing: 1px; padding: 6px 12px; border-radius: 6px; white-space: nowrap;
    opacity: 0; pointer-events: none; transition: opacity 0.15s ease; z-index: 200;
  }
  #sidebar.collapsed .nav-item:hover::after { opacity: 1; }
  #sidebar.collapsed .nav-badge, #sidebar.collapsed .logo-text, #sidebar.collapsed .user-info, #sidebar.collapsed .nav-label { display: none; }
  #sidebar.collapsed .logo-mark { justify-content: center; }
  #sidebar.collapsed .logo-icon { margin: 0; }
  #sidebar.collapsed .nav-section-label { opacity: 0; pointer-events: none; }
  #sidebar.collapsed .user-card { justify-content: center; padding: 10px 8px; }

  /* ===== HEADER ===== */
  #header { position: fixed; top: 0; left: var(--sidebar-w); right: 0; height: var(--header-h); background: rgba(13,13,13,0.97); border-bottom: 1px solid var(--border); backdrop-filter: blur(10px); z-index: 99; display: flex; align-items: center; padding: 0 24px; gap: 16px; transition: left 0.35s cubic-bezier(.77,0,.18,1); }
  #sidebar.collapsed ~ #header { left: 64px; }
  #back-btn { display: none; align-items: center; justify-content: center; width: 34px; height: 34px; border-radius: 8px; border: 1px solid var(--border); background: transparent; color: var(--text-dim); cursor: pointer; transition: all 0.2s ease; flex-shrink: 0; margin-right: 4px; }
  #back-btn:hover { background: var(--neon-dim); border-color: var(--neon); color: var(--neon); transform: translateX(-2px); }
  #back-btn.visible { display: flex; }
  
  .page-title { font-size: 14px; font-weight: 600; color: var(--neon); letter-spacing: 2px; }
  .breadcrumb { font-size: 11px; color: var(--text-dim); letter-spacing: 1px; }
  .header-right { margin-left: auto; display: flex; align-items: center; gap: 12px; }
  .header-clock { font-family: 'Share Tech Mono', monospace; font-size: 13px; color: var(--neon); letter-spacing: 2px; }

  /* ===== BUTTONS ===== */
  .btn { display: inline-flex; align-items: center; gap: 6px; padding: 7px 16px; border-radius: 6px; font-family: 'Josefin Sans', sans-serif; font-size: 12px; font-weight: 600; letter-spacing: 1px; cursor: pointer; transition: all 0.2s ease; border: none; text-transform: uppercase; }
  .btn-primary { background: var(--neon); color: #000; }
  .btn-primary:hover { background: #d4ff1a; transform: translateY(-1px); }
  .btn-ghost { background: transparent; color: var(--neon); border: 1px solid var(--border-bright); }
  .btn-ghost:hover { background: var(--neon-dim); border-color: var(--neon); }
  .btn-danger { background: transparent; color: var(--danger); border: 1px solid rgba(255,77,106,0.4); }
  .btn-danger:hover { background: rgba(255,77,106,0.1); }
  .btn-export { background: rgba(77,184,255,0.1); color: var(--info); border: 1px solid rgba(77,184,255,0.3); }
  .btn-export:hover { background: rgba(77,184,255,0.2); }

  /* ===== MAIN CONTENT & ANIMATIONS ===== */
  #main { margin-left: var(--sidebar-w); margin-top: var(--header-h); padding: 24px; min-height: calc(100vh - var(--header-h)); position: relative; z-index: 1; transition: margin-left 0.35s cubic-bezier(.77,0,.18,1); }
  #sidebar.collapsed ~ #header ~ #main, #sidebar.collapsed + #header + #main { margin-left: 64px; }
  .page { display: none; animation: pageIn 0.4s cubic-bezier(.25,.46,.45,.94) forwards; }
  .page.active { display: block; }

  @keyframes pageIn { from { opacity: 0; transform: translateY(16px) scale(0.98); filter: blur(4px); } to { opacity: 1; transform: translateY(0) scale(1); filter: blur(0); } }
  @keyframes slideInRight { from { opacity: 0; transform: translateX(30px); } to { opacity: 1; transform: translateX(0); } }
  @keyframes fadeUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
  @keyframes pulse-glow { 0%, 100% { opacity: 1; } 50% { opacity: 0.6; } }

  .stagger-1 { animation-delay: 0.05s; } .stagger-2 { animation-delay: 0.1s; } .stagger-3 { animation-delay: 0.15s; }
  .stagger-4 { animation-delay: 0.2s; } .stagger-5 { animation-delay: 0.25s; }

  /* ===== CARDS ===== */
  .card { background: var(--surface); border: 1px solid var(--border); border-radius: 12px; padding: 20px; position: relative; overflow: hidden; backdrop-filter: blur(10px); }
  .card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 1px; background: linear-gradient(90deg, transparent, var(--neon), transparent); opacity: 0; transition: opacity 0.3s; }
  .card:hover::before { opacity: 1; }
  .card-title { font-size: 11px; font-weight: 600; letter-spacing: 2px; color: var(--text-dim); text-transform: uppercase; margin-bottom: 12px; }

  /* ===== STAT CARDS ===== */
  .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 16px; margin-bottom: 24px; }
  .stat-card { background: var(--surface); border: 1px solid var(--border); border-radius: 12px; padding: 20px; position: relative; overflow: hidden; cursor: pointer; transition: all 0.3s ease; animation: fadeUp 0.5s ease forwards; opacity: 0; }
  .stat-card:hover { border-color: var(--border-bright); transform: translateY(-3px); box-shadow: 0 8px 24px rgba(0,0,0,0.3); }
  .stat-card::after { content: ''; position: absolute; bottom: 0; left: 0; right: 0; height: 2px; background: linear-gradient(90deg, var(--neon), transparent); }
  .stat-value { font-size: 32px; font-weight: 700; color: var(--text-bright); line-height: 1; margin-bottom: 6px; }
  .stat-label { font-size: 11px; color: var(--text-dim); letter-spacing: 1px; text-transform: uppercase; }
  .stat-icon { position: absolute; top: 16px; right: 16px; width: 40px; height: 40px; background: var(--neon-dim); border: 1px solid var(--border); border-radius: 8px; display: flex; align-items: center; justify-content: center; color: var(--neon); }

  /* ===== DASHBOARD SPECIFIC ===== */
  .dashboard-grid { display: grid; grid-template-columns: 1fr 340px; gap: 20px; }
  .progress-bar-wrap { height: 6px; background: rgba(255,255,255,0.06); border-radius: 3px; overflow: hidden; margin-top: 6px; }
  .progress-bar-fill { height: 100%; background: var(--neon); border-radius: 3px; transition: width 1s cubic-bezier(.22,1,.36,1); }
  
  .activity-list { display: flex; flex-direction: column; gap: 10px; }
  .activity-item { display: flex; align-items: center; gap: 12px; padding: 12px; background: var(--bg4); border: 1px solid var(--border); border-radius: 8px; animation: fadeUp 0.4s ease forwards; opacity: 0; transition: all 0.2s; }
  .activity-item:hover { border-color: var(--border-bright); background: var(--neon-dim); }
  .activity-dot { width: 10px; height: 10px; border-radius: 50%; flex-shrink: 0; animation: pulse-glow 2s infinite; }
  .activity-content { flex: 1; }
  .activity-title { font-size: 13px; font-weight: 600; color: var(--text-bright); margin-bottom: 2px; }
  .activity-meta { font-size: 11px; color: var(--text-dim); }
  .activity-time { font-family: 'Share Tech Mono', monospace; font-size: 11px; color: var(--text-dim); white-space: nowrap; }

  /* ===== CALENDAR ===== */
  .calendar-card { background: var(--surface); border: 1px solid var(--border); border-radius: 12px; padding: 20px; }
  .cal-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px; }
  .cal-month { font-size: 13px; font-weight: 700; color: var(--neon); letter-spacing: 2px; }
  .cal-nav { display: flex; gap: 6px; }
  .cal-nav-btn { width: 28px; height: 28px; background: var(--bg4); border: 1px solid var(--border); border-radius: 6px; display: flex; align-items: center; justify-content: center; cursor: pointer; color: var(--neon); transition: all 0.2s; }
  .cal-nav-btn:hover { background: var(--neon-dim); border-color: var(--neon); }
  .cal-weekdays { display: grid; grid-template-columns: repeat(7, 1fr); text-align: center; margin-bottom: 8px; }
  .cal-day-label { font-size: 10px; font-weight: 600; letter-spacing: 1px; color: var(--text-dim); padding: 4px; text-transform: uppercase; }
  .cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 2px; }
  .cal-day { aspect-ratio: 1; display: flex; align-items: center; justify-content: center; border-radius: 8px; font-size: 12px; font-weight: 500; cursor: pointer; transition: all 0.2s; position: relative; color: var(--text); }
  .cal-day-inner { width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; transition: background 0.15s; }
  .cal-day:not(.today):not(.holiday):hover .cal-day-inner { background: var(--neon-dim); color: var(--neon); }
  .cal-day.other-month { color: rgba(255,255,255,0.12); }
  .cal-day.is-sunday { color: #ff6b6b; }
  .cal-day.holiday { color: #ffffff; font-weight: 700; }
  .cal-day.holiday .cal-day-inner { background: rgba(255,61,85,0.85); border-radius: 50%; width: 28px; height: 28px; display: flex; align-items: center; justify-content: center; position: relative; z-index: 1; }
  .cal-day.today .cal-day-inner { background: var(--neon); border-radius: 50%; width: 28px; height: 28px; display: flex; align-items: center; justify-content: center; color: #000; font-weight: 700; position: relative; z-index: 1; }
  .cal-day.holiday.today .cal-day-inner { background: var(--neon); color: #000; }
  .cal-day.holiday::before { content: attr(data-holiday); position: absolute; bottom: calc(100% + 6px); left: 50%; transform: translateX(-50%); background: #1a1a1a; border: 1px solid rgba(255,61,85,0.5); color: #ff6b6b; font-size: 10px; font-weight: 600; letter-spacing: 0.5px; padding: 5px 10px; border-radius: 6px; white-space: nowrap; opacity: 0; pointer-events: none; transition: opacity 0.15s ease; z-index: 999; max-width: 180px; white-space: normal; text-align: center; line-height: 1.3; }
  .cal-day.holiday:hover::before { opacity: 1; }
  .cal-day.has-event::after { content: ''; position: absolute; bottom: 2px; left: 50%; transform: translateX(-50%); width: 4px; height: 4px; border-radius: 50%; background: var(--neon); }
  .cal-day.today.has-event::after { background: #000; }
  
  .cal-legend { display: flex; align-items: center; gap: 16px; margin-top: 10px; padding-top: 10px; border-top: 1px solid var(--border); }
  .cal-legend-item { display: flex; align-items: center; gap: 6px; font-size: 10px; color: var(--text-dim); letter-spacing: 0.5px; }
  .legend-dot { width: 10px; height: 10px; border-radius: 50%; flex-shrink: 0; }
  .cal-events { margin-top: 16px; border-top: 1px solid var(--border); padding-top: 12px; max-height: 200px; overflow-y: auto; }
  .cal-event-item { display: flex; align-items: flex-start; gap: 10px; padding: 8px; border-radius: 8px; margin-bottom: 6px; background: var(--neon-dim); border: 1px solid var(--border); animation: fadeUp 0.3s ease; }
  .cal-event-dot { width: 8px; height: 8px; border-radius: 50%; background: var(--neon); margin-top: 3px; flex-shrink: 0; }
  .cal-event-text { font-size: 12px; line-height: 1.4; flex:1; }
  .cal-event-date { font-size: 10px; color: var(--text-dim); }

  /* ===== TABLE ===== */
  .table-wrapper { overflow-x: auto; border-radius: 8px; border: 1px solid var(--border); }
  table { width: 100%; border-collapse: collapse; }
  thead tr { background: rgba(255,255,255,0.03); border-bottom: 1px solid var(--border); }
  th { padding: 12px 16px; font-size: 10px; font-weight: 600; letter-spacing: 2px; color: var(--neon); text-transform: uppercase; text-align: left; white-space: nowrap; }
  tbody tr { border-bottom: 1px solid rgba(255,255,255,0.04); transition: background 0.2s; }
  tbody tr:hover { background: var(--neon-dim); }
  td { padding: 12px 16px; font-size: 13px; color: var(--text); white-space: nowrap; }
  
  .badge { display: inline-block; padding: 3px 10px; border-radius: 20px; font-size: 10px; font-weight: 600; letter-spacing: 1px; text-transform: uppercase; }
  .badge-green { background: rgba(200,255,0,0.1); color: var(--neon); border: 1px solid rgba(200,255,0,0.3); }
  .badge-yellow { background: rgba(255,170,0,0.1); color: var(--warning); border: 1px solid rgba(255,170,0,0.3); }
  .badge-red { background: rgba(255,61,85,0.1); color: var(--danger); border: 1px solid rgba(255,61,85,0.3); }
  .badge-blue { background: rgba(77,184,255,0.1); color: var(--info); border: 1px solid rgba(77,184,255,0.3); }

  .action-btns { display: flex; gap: 6px; }
  .icon-btn { width: 28px; height: 28px; display: flex; align-items: center; justify-content: center; border-radius: 6px; border: 1px solid var(--border); background: transparent; color: var(--text-dim); cursor: pointer; transition: all 0.2s; }
  .icon-btn:hover.edit { border-color: var(--info); color: var(--info); background: rgba(77,184,255,0.08); }
  .icon-btn:hover.delete { border-color: var(--danger); color: var(--danger); background: rgba(255,61,85,0.08); }
  .icon-btn:hover.view { border-color: var(--neon); color: var(--neon); background: var(--neon-dim); }

  /* ===== FORM ===== */
  .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 16px; }
  .form-group { display: flex; flex-direction: column; gap: 6px; }
  label { font-size: 11px; font-weight: 600; letter-spacing: 1px; color: var(--text); text-transform: uppercase; }
  input, select, textarea { background: var(--bg4); border: 1px solid var(--border); border-radius: 6px; padding: 10px 14px; color: var(--text-bright); font-family: 'Josefin Sans', sans-serif; font-size: 13px; outline: none; transition: all 0.2s; width: 100%; }
  input:focus, select:focus, textarea:focus { border-color: var(--neon); box-shadow: 0 0 0 2px rgba(200,255,0,0.12); }
  textarea { resize: vertical; min-height: 80px; }
  select:disabled { opacity: 0.35; cursor: not-allowed; }
  optgroup { background: var(--bg3); color: var(--neon); font-weight: 700; font-size: 10px; letter-spacing: 1px; }
  option { background: var(--bg4); color: var(--text-bright); font-weight: 400; }

  /* ===== TOOLBAR ===== */
  .toolbar { display: flex; align-items: center; gap: 12px; margin-bottom: 16px; flex-wrap: wrap; }
  .toolbar h2 { font-size: 14px; font-weight: 700; color: var(--text-bright); letter-spacing: 2px; flex: 1; }
  .search-bar { position: relative; width: 260px; }
  .search-bar input { padding-left: 36px; width: 100%; }
  .search-bar svg { position: absolute; left: 10px; top: 50%; transform: translateY(-50%); color: var(--text-dim); width: 16px; height: 16px; }

  /* ===== MODAL ===== */
  .modal-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.7); backdrop-filter: blur(4px); z-index: 1000; align-items: center; justify-content: center; animation: fadeIn 0.2s ease; }
  .modal-overlay.open { display: flex; }
  @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
  .modal { background: var(--bg3); border: 1px solid var(--border-bright); border-radius: 16px; padding: 28px; width: 90%; max-width: 640px; max-height: 90vh; overflow-y: auto; animation: modalIn 0.3s cubic-bezier(.34,1.56,.64,1) forwards; position: relative; }
  @keyframes modalIn { from { opacity: 0; transform: scale(0.9) translateY(20px); } to { opacity: 1; transform: scale(1) translateY(0); } }
  .modal-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; padding-bottom: 16px; border-bottom: 1px solid var(--border); }
  .modal-title { font-size: 14px; font-weight: 700; color: var(--neon); }
  .close-btn { width: 28px; height: 28px; display: flex; align-items: center; justify-content: center; border-radius: 50%; border: 1px solid var(--border); background: transparent; color: var(--text-dim); cursor: pointer; transition: all 0.2s; }
  .close-btn:hover { background: rgba(255,77,106,0.1); border-color: var(--danger); color: var(--danger); }
  .modal-footer { display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px; padding-top: 16px; border-top: 1px solid var(--border); }
  .info-row { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid var(--border); font-size: 13px; }
  .info-row:last-child { border-bottom: none; }
  .info-row .key { color: var(--text-dim); }
  .info-row .val { color: var(--text-bright); font-weight: 500; }

  /* Toast */
  #toast { position: fixed; bottom: 24px; right: 24px; background: var(--bg3); border: 1px solid var(--neon); border-radius: 10px; padding: 14px 20px; color: var(--neon); font-size: 13px; font-weight: 600; letter-spacing: 0.5px; z-index: 9999; transform: translateX(200%); transition: transform 0.4s cubic-bezier(.34,1.56,.64,1); display: flex; align-items: center; gap: 10px; }
  #toast.show { transform: translateX(0); }

  ::-webkit-scrollbar { width: 6px; height: 6px; }
  ::-webkit-scrollbar-track { background: var(--bg2); }
  ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }
  ::-webkit-scrollbar-thumb:hover { background: var(--neon); }

  @media (max-width: 768px) {
    .dashboard-grid { grid-template-columns: 1fr; }
    .stats-grid { grid-template-columns: repeat(2, 1fr); }
    .toolbar h2 { width: 100%; flex: none; }
  }
</style>
</head>
<body>

<div id="login-overlay">
  <div class="login-box">
    <h1>SIKANDA</h1>
    <p>Sistem Informasi Pengendalian & Penanganan Sengketa<br>Kanwil BPN Provinsi NTB</p>
    <input type="password" id="login-pwd" placeholder="Masukkan Password: admin" onkeypress="if(event.key==='Enter') verifyLogin()">
    <button class="btn btn-primary" style="width:100%; justify-content:center; padding:12px;" onclick="verifyLogin()">LOGIN SISTEM</button>
    <div id="login-error" style="color:var(--danger); font-size:11px; margin-top:10px; opacity:0; transition:0.3s;">Password salah! Gunakan: admin</div>
  </div>
</div>

<nav id="sidebar">
  <div class="sidebar-header">
    <div class="logo-mark">
      <div class="logo-icon">BPN</div>
      <div class="logo-text">
        <div class="logo-title">SIKANDA</div>
        <div class="logo-sub">KANWIL BPN PROV. NTB<br>BIDANG PPSEN</div>
      </div>
    </div>
    <button id="collapse-btn" onclick="toggleSidebar()" title="Tutup/Buka Sidebar">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"/></svg>
    </button>
  </div>

  <div class="sidebar-nav">
    <div class="nav-section-label">UTAMA</div>
    <div class="nav-item active" data-label="Dashboard" onclick="navigateTo('dashboard', this)">
      <div class="nav-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg></div>
      <span class="nav-label">Dashboard</span>
    </div>

    <div class="nav-section-label">SURAT</div>
    <div class="nav-item" data-label="Surat Masuk" onclick="navigateTo('surat-masuk', this)">
      <div class="nav-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07A19.5 19.5 0 013 4.18 2 2 0 014.98 2h3a2 2 0 012 1.72 12.84 12.84 0 00.7 2.81 2 2 0 01-.45 2.11L9.09 9.91a16 16 0 006 6l1.27-1.27a2 2 0 012.11-.45 12.84 12.84 0 002.81.7A2 2 0 0122 16.92z"/></svg></div>
      <span class="nav-label">Surat Masuk</span>
      <span class="nav-badge" id="badge-masuk">0</span>
    </div>
    <div class="nav-item" data-label="Surat Keluar" onclick="navigateTo('surat-keluar', this)">
      <div class="nav-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg></div>
      <span class="nav-label">Surat Keluar</span>
      <span class="nav-badge" id="badge-keluar">0</span>
    </div>

    <div class="nav-section-label">PEMBATALAN</div>
    <div class="nav-item" data-label="Permohonan Pembatalan" onclick="navigateTo('pembatalan', this)">
      <div class="nav-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="4.93" y1="4.93" x2="19.07" y2="19.07"/></svg></div>
      <span class="nav-label">Permohonan Pembatalan</span>
    </div>

    <div class="nav-section-label">PERKARA & SENGKETA</div>
    <div class="nav-item" data-label="Penanganan Perkara" onclick="navigateTo('perkara', this)">
      <div class="nav-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="2" x2="12" y2="22"/><path d="M12 2L5 7l-3 7h6l-3-7"/><path d="M12 2l7 5 3 7h-6l3-7"/><line x1="5" y1="21" x2="19" y2="21"/><path d="M5 14a4 4 0 0 0 6 0"/><path d="M13 14a4 4 0 0 0 6 0"/></svg></div>
      <span class="nav-label">Penanganan Perkara</span>
    </div>
    <div class="nav-item" data-label="Penanganan Sengketa" onclick="navigateTo('sengketa', this)">
      <div class="nav-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 00-3-3.87"/><path d="M16 3.13a4 4 0 010 7.75"/></svg></div>
      <span class="nav-label">Penanganan Sengketa</span>
    </div>

    <div class="nav-section-label">PIDANA</div>
    <div class="nav-item" data-label="Tindak Pidana Pertanahan" onclick="navigateTo('tipidana', this)">
      <div class="nav-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="7" cy="14" r="3"/><circle cx="17" cy="14" r="3"/><path d="M7 11V8a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v3"/><line x1="10" y1="14" x2="14" y2="14"/><path d="M4.5 14H4a2 2 0 0 1-2-2v-1a2 2 0 0 1 2-2h.5"/><path d="M19.5 14H20a2 2 0 0 0 2-2v-1a2 2 0 0 0-2-2h-.5"/></svg></div>
      <span class="nav-label">Tindak Pidana Pertanahan</span>
    </div>
  </div>

  <div class="sidebar-footer">
    <div class="user-card">
      <div class="user-avatar">AD</div>
      <div class="user-info">
        <div class="user-name">Administrator</div>
        <div class="user-role">Kepala Bidang PPSEN</div>
      </div>
    </div>
  </div>
</nav>

<header id="header">
  <button id="back-btn" onclick="goBack()" title="Kembali ke halaman sebelumnya">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"/></svg>
  </button>
  <div>
    <div class="page-title" id="page-title">DASHBOARD</div>
    <div class="breadcrumb" id="breadcrumb">Beranda / Dashboard</div>
  </div>
  <div class="header-right">
    <div class="header-clock" id="clock">--:--:--</div>
    <button class="btn btn-danger" onclick="logout()" title="Keluar dari Sistem">
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
      LOGOUT
    </button>
  </div>
</header>

<main id="main">

  <div class="page active" id="page-dashboard">
    <div class="stats-grid">
      <div class="stat-card stagger-1" onclick="navigateToWithNav('surat-masuk')">
        <div class="stat-value" id="stat-masuk">0</div>
        <div class="stat-label">Surat Masuk</div>
        <div class="stat-trend">Data tersimpan di perangkat</div>
        <div class="stat-icon"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07A19.5 19.5 0 013 4.18 2 2 0 014.98 2h3a2 2 0 012 1.72 12.84 12.84 0 00.7 2.81 2 2 0 01-.45 2.11L9.09 9.91a16 16 0 006 6l1.27-1.27a2 2 0 012.11-.45 12.84 12.84 0 002.81.7A2 2 0 0122 16.92z"/></svg></div>
      </div>
      <div class="stat-card stagger-2" onclick="navigateToWithNav('surat-keluar')">
        <div class="stat-value" id="stat-keluar">0</div>
        <div class="stat-label">Surat Keluar</div>
        <div class="stat-trend">Data tersimpan di perangkat</div>
        <div class="stat-icon"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg></div>
      </div>
      <div class="stat-card stagger-3" onclick="navigateToWithNav('pembatalan')">
        <div class="stat-value" id="stat-pembatalan">0</div>
        <div class="stat-label">Permohonan Pembatalan</div>
        <div class="stat-trend">Data tersimpan di perangkat</div>
        <div class="stat-icon" style="color:var(--warning)"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="4.93" y1="4.93" x2="19.07" y2="19.07"/></svg></div>
      </div>
      <div class="stat-card stagger-4" onclick="navigateToWithNav('perkara')">
        <div class="stat-value" id="stat-perkara">0</div>
        <div class="stat-label">Penanganan Perkara</div>
        <div class="stat-trend">Data tersimpan di perangkat</div>
        <div class="stat-icon" style="color:var(--danger)"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="2" x2="12" y2="22"/><path d="M12 2L5 7l-3 7h6l-3-7"/><path d="M12 2l7 5 3 7h-6l3-7"/><line x1="5" y1="21" x2="19" y2="21"/><path d="M5 14a4 4 0 0 0 6 0"/><path d="M13 14a4 4 0 0 0 6 0"/></svg></div>
      </div>
      <div class="stat-card stagger-5" onclick="navigateToWithNav('sengketa')">
        <div class="stat-value" id="stat-sengketa">0</div>
        <div class="stat-label">Penanganan Sengketa</div>
        <div class="stat-trend">Data tersimpan di perangkat</div>
        <div class="stat-icon" style="color:var(--info)"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 00-3-3.87"/><path d="M16 3.13a4 4 0 010 7.75"/></svg></div>
      </div>
      <div class="stat-card stagger-5" onclick="navigateToWithNav('tipidana')">
        <div class="stat-value" id="stat-tipidana">0</div>
        <div class="stat-label">Tindak Pidana Pertanahan</div>
        <div class="stat-trend">Data tersimpan di perangkat</div>
        <div class="stat-icon" style="color:var(--danger)"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="7" cy="14" r="3"/><circle cx="17" cy="14" r="3"/><path d="M7 11V8a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v3"/><line x1="10" y1="14" x2="14" y2="14"/><path d="M4.5 14H4a2 2 0 0 1-2-2v-1a2 2 0 0 1 2-2h.5"/><path d="M19.5 14H20a2 2 0 0 0 2-2v-1a2 2 0 0 0-2-2h-.5"/></svg></div>
      </div>
    </div>

    <div class="dashboard-grid">
      <div>
        <div class="card" style="margin-bottom:20px; animation: fadeUp 0.5s 0.2s ease forwards; opacity:0;">
          <div class="card-title">STATUS PENYELESAIAN 2025</div>
          <div style="margin-bottom:12px;">
            <div style="display:flex;justify-content:space-between;font-size:12px;margin-bottom:4px;"><span>Sengketa Pertanahan</span><span style="color:var(--neon)">68%</span></div>
            <div class="progress-bar-wrap"><div class="progress-bar-fill" style="width:68%"></div></div>
          </div>
          <div style="margin-bottom:12px;">
            <div style="display:flex;justify-content:space-between;font-size:12px;margin-bottom:4px;"><span>Permohonan Pembatalan</span><span style="color:var(--warning)">45%</span></div>
            <div class="progress-bar-wrap"><div class="progress-bar-fill" style="width:45%;background:linear-gradient(90deg,var(--warning),var(--neon));"></div></div>
          </div>
          <div style="margin-bottom:12px;">
            <div style="display:flex;justify-content:space-between;font-size:12px;margin-bottom:4px;"><span>Perkara di Pengadilan</span><span style="color:var(--danger)">33%</span></div>
            <div class="progress-bar-wrap"><div class="progress-bar-fill" style="width:33%;background:linear-gradient(90deg,var(--danger),var(--warning));"></div></div>
          </div>
          <div>
            <div style="display:flex;justify-content:space-between;font-size:12px;margin-bottom:4px;"><span>Tindak Pidana Pertanahan</span><span style="color:var(--info)">80%</span></div>
            <div class="progress-bar-wrap"><div class="progress-bar-fill" style="width:80%;background:linear-gradient(90deg,var(--info),var(--neon));"></div></div>
          </div>
        </div>

        <div class="card" style="animation: fadeUp 0.5s 0.3s ease forwards; opacity:0;">
          <div class="card-title">AKTIVITAS TERKINI (SIMULASI)</div>
          <div class="activity-list">
            <div class="activity-item stagger-1" style="opacity:0;">
              <div class="activity-dot" style="background:var(--neon);"></div>
              <div class="activity-content">
                <div class="activity-title">Surat Masuk Diterima — 021/SM/II/2025</div>
                <div class="activity-meta">Dari: Kantor ATR/BPN Lombok Barat · Perihal: Sengketa HM No.123</div>
              </div>
              <div class="activity-time">09:42</div>
            </div>
            <div class="activity-item stagger-2" style="opacity:0;">
              <div class="activity-dot" style="background:var(--info);"></div>
              <div class="activity-content">
                <div class="activity-title">Mediasi Sengketa — Kasus #SNG-047</div>
                <div class="activity-meta">Pihak pemohon hadir · Jadwal: 21 Feb 2025</div>
              </div>
              <div class="activity-time">08:30</div>
            </div>
            <div class="activity-item stagger-3" style="opacity:0;">
              <div class="activity-dot" style="background:var(--warning);"></div>
              <div class="activity-content">
                <div class="activity-title">Permohonan Pembatalan Baru — PMB-032</div>
                <div class="activity-meta">Pemohon: H. Lalu Muhamad Rizky · HM No. 445</div>
              </div>
              <div class="activity-time">Kemarin</div>
            </div>
          </div>
        </div>
      </div>

      <div>
        <div class="calendar-card" style="animation: slideInRight 0.5s 0.2s ease forwards; opacity:0;">
          <div class="card-title">KALENDER KEGIATAN</div>
          <div class="cal-header">
            <div class="cal-month" id="cal-month-label">FEBRUARI 2025</div>
            <div class="cal-nav">
              <button class="cal-nav-btn" onclick="changeMonth(-1)"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg></button>
              <button class="cal-nav-btn" onclick="changeMonth(1)"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg></button>
            </div>
          </div>
          <div class="cal-weekdays">
            <div class="cal-day-label">Min</div><div class="cal-day-label">Sen</div><div class="cal-day-label">Sel</div><div class="cal-day-label">Rab</div><div class="cal-day-label">Kam</div><div class="cal-day-label">Jum</div><div class="cal-day-label">Sab</div>
          </div>
          <div class="cal-grid" id="cal-grid"></div>

          <div class="cal-events">
            <div style="font-size:11px;color:var(--text-dim);letter-spacing:1px;margin-bottom:8px;font-family:'Josefin Sans',sans-serif;" id="cal-selected-label">— PILIH TANGGAL UNTUK MELIHAT AGENDA —</div>
            <div id="cal-event-list"></div>
          </div>

          <div class="cal-legend">
            <div class="cal-legend-item"><div class="legend-dot" style="background:var(--neon)"></div><span>Hari Ini</span></div>
            <div class="cal-legend-item"><div class="legend-dot" style="background:#ff3d55"></div><span>Hari Libur Nasional</span></div>
            <div class="cal-legend-item"><div class="legend-dot" style="background:var(--neon);opacity:0.5;"></div><span>Ada Agenda</span></div>
          </div>

          <div style="margin-top:12px;display:flex;gap:8px;">
            <button class="btn btn-ghost" style="flex:1;font-size:11px;" onclick="openCalendarModal()">
              <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg> TAMBAH AGENDA
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="page" id="page-surat-masuk">
    <div class="toolbar">
      <h2>SURAT MASUK</h2>
      <div class="search-bar">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
        <input type="text" placeholder="Cari surat masuk..." oninput="filterTable('tbl-masuk', this.value)">
      </div>
      <select style="width:auto;padding:8px 14px;" onchange="filterTableStatus('tbl-masuk', this.value)">
        <option value="">Semua Status</option><option value="Diterima">Diterima</option><option value="Diproses">Diproses</option><option value="Selesai">Selesai</option>
      </select>
      <button class="btn btn-export" onclick="exportCSV('masuk')">EXPORT CSV</button>
      <button class="btn btn-primary" onclick="showAddForm('surat-masuk')">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg> TAMBAH
      </button>
    </div>

    <div class="card" id="form-surat-masuk" style="display:none; margin-bottom:20px; animation: slideInRight 0.3s ease;">
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;">
        <div class="card-title" style="margin:0">FORM INPUT SURAT MASUK</div>
        <button class="close-btn" onclick="hideForm('form-surat-masuk')"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button>
      </div>
      <div class="form-grid">
        <div class="form-group"><label>Nomor Surat *</label><input type="text" id="sm-nomor" placeholder="Contoh: 021/SM/II/2025" required></div>
        <div class="form-group"><label>Tanggal Terima *</label><input type="date" id="sm-tanggal" required></div>
        <div class="form-group"><label>Asal Surat *</label><input type="text" id="sm-asal" placeholder="Instansi pengirim" required></div>
        <div class="form-group"><label>Perihal *</label><input type="text" id="sm-perihal" placeholder="Perihal surat" required></div>
        <div class="form-group"><label>Status</label><select id="sm-status"><option value="Diterima">Diterima</option><option value="Diproses">Diproses</option><option value="Selesai">Selesai</option></select></div>
        <div class="form-group"><label>Disposisi</label><input type="text" id="sm-disposisi" placeholder="Kepada siapa didisposisi"></div>
      </div>
      <div style="margin-top:16px;display:flex;gap:10px;justify-content:flex-end;">
        <button class="btn btn-ghost" onclick="hideForm('form-surat-masuk')">BATAL</button>
        <button class="btn btn-primary" onclick="addSuratMasuk()">SIMPAN</button>
      </div>
    </div>

    <div class="card">
      <div class="table-wrapper">
        <table id="tbl-masuk">
          <thead><tr><th>No</th><th>Nomor Surat</th><th>Tgl Terima</th><th>Asal Surat</th><th>Perihal</th><th>Status</th><th>Disposisi</th><th>Aksi</th></tr></thead>
          <tbody id="tbody-masuk"></tbody>
        </table>
      </div>
    </div>
  </div>

  <div class="page" id="page-surat-keluar">
    <div class="toolbar">
      <h2>SURAT KELUAR</h2>
      <div class="search-bar"><input type="text" placeholder="Cari surat keluar..." oninput="filterTable('tbl-keluar', this.value)"></div>
      <button class="btn btn-export" onclick="exportCSV('keluar')">EXPORT CSV</button>
      <button class="btn btn-primary" onclick="showAddForm('surat-keluar')">TAMBAH</button>
    </div>
    <div class="card" id="form-surat-keluar" style="display:none; margin-bottom:20px;">
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;">
        <div class="card-title" style="margin:0">FORM INPUT SURAT KELUAR</div>
        <button class="close-btn" onclick="hideForm('form-surat-keluar')"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button>
      </div>
      <div class="form-grid">
        <div class="form-group"><label>Nomor Surat *</label><input type="text" id="sk-nomor" required></div>
        <div class="form-group"><label>Tanggal Surat *</label><input type="date" id="sk-tanggal" required></div>
        <div class="form-group"><label>Ditujukan Kepada *</label><input type="text" id="sk-tujuan" required></div>
        <div class="form-group"><label>Perihal *</label><input type="text" id="sk-perihal" required></div>
        <div class="form-group"><label>Penandatangan *</label><input type="text" id="sk-ttd" required></div>
        <div class="form-group"><label>Status</label><select id="sk-status"><option value="Terkirim">Terkirim</option><option value="Draf">Draf</option></select></div>
      </div>
      <div style="margin-top:16px;display:flex;gap:10px;justify-content:flex-end;">
        <button class="btn btn-ghost" onclick="hideForm('form-surat-keluar')">BATAL</button>
        <button class="btn btn-primary" onclick="addSuratKeluar()">SIMPAN</button>
      </div>
    </div>
    <div class="card"><div class="table-wrapper"><table id="tbl-keluar"><thead><tr><th>No</th><th>Nomor Surat</th><th>Tanggal</th><th>Ditujukan Kepada</th><th>Perihal</th><th>Penandatangan</th><th>Status</th><th>Aksi</th></tr></thead><tbody id="tbody-keluar"></tbody></table></div></div>
  </div>

  <div class="page" id="page-pembatalan">
    <div class="toolbar">
      <h2>PERMOHONAN PEMBATALAN</h2>
      <div class="search-bar"><input type="text" placeholder="Cari permohonan..." oninput="filterTable('tbl-pembatalan', this.value)"></div>
      <button class="btn btn-export" onclick="exportCSV('pembatalan')">EXPORT CSV</button>
      <button class="btn btn-primary" onclick="showAddForm('pembatalan')">TAMBAH</button>
    </div>
    <div class="card" id="form-pembatalan" style="display:none; margin-bottom:20px;">
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;">
        <div class="card-title" style="margin:0">FORM PERMOHONAN PEMBATALAN</div>
        <button class="close-btn" onclick="hideForm('form-pembatalan')"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button>
      </div>
      <div class="form-grid">
        <div class="form-group"><label>Nomor Berkas *</label><input type="text" id="pmb-nomor" required></div>
        <div class="form-group"><label>Tanggal Permohonan *</label><input type="date" id="pmb-tanggal" required></div>
        <div class="form-group"><label>Nama Pemohon *</label><input type="text" id="pmb-pemohon" required></div>
        <div class="form-group"><label>Objek Permohonan *</label><input type="text" id="pmb-objek" required></div>
        <div class="form-group"><label>Kabupaten / Kota *</label>
          <select id="pmb-kabkota" onchange="onKabKotaChange()" required>
            <option value="">-- Pilih Kabupaten/Kota --</option>
            <optgroup label="KOTA"><option value="Kota Mataram">Kota Mataram</option><option value="Kota Bima">Kota Bima</option></optgroup>
            <optgroup label="KABUPATEN"><option value="Kabupaten Lombok Barat">Kabupaten Lombok Barat</option><option value="Kabupaten Lombok Tengah">Kabupaten Lombok Tengah</option><option value="Kabupaten Lombok Timur">Kabupaten Lombok Timur</option><option value="Kabupaten Lombok Utara">Kabupaten Lombok Utara</option><option value="Kabupaten Sumbawa">Kabupaten Sumbawa</option><option value="Kabupaten Sumbawa Barat">Kabupaten Sumbawa Barat</option><option value="Kabupaten Dompu">Kabupaten Dompu</option><option value="Kabupaten Bima">Kabupaten Bima</option></optgroup>
          </select>
        </div>
        <div class="form-group"><label>Kecamatan</label><select id="pmb-kecamatan" onchange="onKecamatanChange()" disabled><option value="">-- Pilih Kecamatan --</option></select></div>
        <div class="form-group"><label>Desa / Kelurahan</label><select id="pmb-desa" disabled><option value="">-- Pilih Desa/Kelurahan --</option></select></div>
        <div class="form-group"><label>Alasan Pembatalan</label><select id="pmb-alasan"><option value="Cacat Administrasi">Cacat Administrasi</option><option value="Putusan Pengadilan">Putusan Pengadilan</option><option value="Tumpang Tindih">Tumpang Tindih</option></select></div>
        <div class="form-group"><label>Status</label><select id="pmb-status"><option value="Baru">Baru</option><option value="Diproses">Diproses</option><option value="Selesai">Selesai</option><option value="Ditolak">Ditolak</option></select></div>
      </div>
      <div style="margin-top:16px;display:flex;gap:10px;justify-content:flex-end;">
        <button class="btn btn-ghost" onclick="hideForm('form-pembatalan')">BATAL</button>
        <button class="btn btn-primary" onclick="addPembatalan()">SIMPAN</button>
      </div>
    </div>
    <div class="card"><div class="table-wrapper"><table id="tbl-pembatalan"><thead><tr><th>No</th><th>Nomor Berkas</th><th>Tgl Permohonan</th><th>Pemohon</th><th>Objek</th><th>Kabupaten/Kota</th><th>Letak Tanah</th><th>Alasan</th><th>Status</th><th>Aksi</th></tr></thead><tbody id="tbody-pembatalan"></tbody></table></div></div>
  </div>

  <div class="page" id="page-perkara">
    <div class="toolbar">
      <h2>PENANGANAN PERKARA</h2>
      <div class="search-bar"><input type="text" placeholder="Cari perkara..." oninput="filterTable('tbl-perkara', this.value)"></div>
      <button class="btn btn-export" onclick="exportCSV('perkara')">EXPORT CSV</button>
      <button class="btn btn-primary" onclick="showAddForm('perkara')">TAMBAH</button>
    </div>
    <div class="card" id="form-perkara" style="display:none; margin-bottom:20px;">
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;">
        <div class="card-title" style="margin:0">FORM PENANGANAN PERKARA</div>
        <button class="close-btn" onclick="hideForm('form-perkara')"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button>
      </div>
      <div class="form-grid">
        <div class="form-group"><label>Nomor Perkara *</label><input type="text" id="prk-nomor" required></div>
        <div class="form-group"><label>Tanggal Masuk *</label><input type="date" id="prk-tanggal" required></div>
        <div class="form-group"><label>Penggugat *</label><input type="text" id="prk-penggugat" required></div>
        <div class="form-group"><label>Tergugat *</label><input type="text" id="prk-tergugat" required></div>
        <div class="form-group"><label>Nomor Register</label><input type="text" id="prk-register"></div>
        <div class="form-group"><label>Objek Sengketa</label><input type="text" id="prk-objek"></div>
        <div class="form-group"><label>Pengadilan</label><input type="text" id="prk-pengadilan"></div>
        <div class="form-group"><label>Status</label><select id="prk-status"><option value="Aktif">Aktif</option><option value="Banding">Banding</option><option value="Kasasi">Kasasi</option><option value="Inkracht">Inkracht</option><option value="Selesai">Selesai</option></select></div>
      </div>
      <div style="margin-top:16px;display:flex;gap:10px;justify-content:flex-end;">
        <button class="btn btn-ghost" onclick="hideForm('form-perkara')">BATAL</button>
        <button class="btn btn-primary" onclick="addPerkara()">SIMPAN</button>
      </div>
    </div>
    <div class="card"><div class="table-wrapper"><table id="tbl-perkara"><thead><tr><th>No</th><th>Nomor Perkara</th><th>Tgl Masuk</th><th>Penggugat</th><th>Tergugat</th><th>No. Register</th><th>Objek</th><th>Pengadilan</th><th>Status</th><th>Aksi</th></tr></thead><tbody id="tbody-perkara"></tbody></table></div></div>
  </div>

  <div class="page" id="page-sengketa">
    <div class="toolbar">
      <h2>PENANGANAN SENGKETA</h2>
      <div class="search-bar"><input type="text" placeholder="Cari sengketa..." oninput="filterTable('tbl-sengketa', this.value)"></div>
      <button class="btn btn-export" onclick="exportCSV('sengketa')">EXPORT CSV</button>
      <button class="btn btn-primary" onclick="showAddForm('sengketa')">TAMBAH</button>
    </div>
    <div class="card" id="form-sengketa" style="display:none; margin-bottom:20px;">
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;">
        <div class="card-title" style="margin:0">FORM PENANGANAN SENGKETA</div>
        <button class="close-btn" onclick="hideForm('form-sengketa')"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button>
      </div>
      <div class="form-grid">
        <div class="form-group"><label>Nomor Sengketa *</label><input type="text" id="sng-nomor" required></div>
        <div class="form-group"><label>Tanggal Masuk *</label><input type="date" id="sng-tanggal" required></div>
        <div class="form-group"><label>Pemohon *</label><input type="text" id="sng-pemohon" required></div>
        <div class="form-group"><label>Terlapor *</label><input type="text" id="sng-terlapor" required></div>
        <div class="form-group"><label>Objek Sengketa</label><input type="text" id="sng-objek"></div>
        <div class="form-group"><label>Letak Tanah</label><input type="text" id="sng-letak"></div>
        <div class="form-group"><label>Jenis Sengketa</label><select id="sng-jenis"><option value="Tumpang Tindih Sertipikat">Tumpang Tindih Sertipikat</option><option value="Penguasaan Tanah">Penguasaan Tanah</option><option value="Batas Bidang Tanah">Batas Bidang Tanah</option><option value="Waris">Waris</option><option value="Lainnya">Lainnya</option></select></div>
        <div class="form-group"><label>Status</label><select id="sng-status"><option value="Mediasi">Mediasi</option><option value="Gelar Kasus">Gelar Kasus</option><option value="Penyelidikan">Penyelidikan</option><option value="Selesai">Selesai</option></select></div>
      </div>
      <div style="margin-top:16px;display:flex;gap:10px;justify-content:flex-end;">
        <button class="btn btn-ghost" onclick="hideForm('form-sengketa')">BATAL</button>
        <button class="btn btn-primary" onclick="addSengketa()">SIMPAN</button>
      </div>
    </div>
    <div class="card"><div class="table-wrapper"><table id="tbl-sengketa"><thead><tr><th>No</th><th>Nomor Sengketa</th><th>Tgl Masuk</th><th>Pemohon</th><th>Terlapor</th><th>Objek</th><th>Letak Tanah</th><th>Jenis</th><th>Status</th><th>Aksi</th></tr></thead><tbody id="tbody-sengketa"></tbody></table></div></div>
  </div>

  <div class="page" id="page-tipidana">
    <div class="toolbar">
      <h2>TINDAK PIDANA PERTANAHAN</h2>
      <div class="search-bar"><input type="text" placeholder="Cari kasus..." oninput="filterTable('tbl-tipidana', this.value)"></div>
      <button class="btn btn-export" onclick="exportCSV('tipidana')">EXPORT CSV</button>
      <button class="btn btn-primary" onclick="showAddForm('tipidana')">TAMBAH</button>
    </div>
    <div class="card" id="form-tipidana" style="display:none; margin-bottom:20px;">
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;">
        <div class="card-title" style="margin:0">FORM TINDAK PIDANA PERTANAHAN</div>
        <button class="close-btn" onclick="hideForm('form-tipidana')"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button>
      </div>
      <div class="form-grid">
        <div class="form-group"><label>Nomor Kasus *</label><input type="text" id="tpa-nomor" required></div>
        <div class="form-group"><label>Tanggal Laporan *</label><input type="date" id="tpa-tanggal" required></div>
        <div class="form-group"><label>Tersangka *</label><input type="text" id="tpa-tersangka" required></div>
        <div class="form-group"><label>Jenis Tindak Pidana</label><select id="tpa-jenis"><option value="Pemalsuan Sertipikat">Pemalsuan Sertipikat</option><option value="Penipuan Jual Beli Tanah">Penipuan Jual Beli Tanah</option><option value="Pendudukan Tanah Tanpa Hak">Pendudukan Tanah Tanpa Hak</option><option value="Pemalsuan Dokumen">Pemalsuan Dokumen</option><option value="Lainnya">Lainnya</option></select></div>
        <div class="form-group"><label>Pasal Yang Dilanggar</label><input type="text" id="tpa-pasal"></div>
        <div class="form-group"><label>Instansi Penanganan</label><input type="text" id="tpa-instansi"></div>
        <div class="form-group"><label>Objek / Lokasi</label><input type="text" id="tpa-objek"></div>
        <div class="form-group"><label>Status Penanganan</label><select id="tpa-status"><option value="Laporan">Laporan</option><option value="Penyelidikan">Penyelidikan</option><option value="Penyidikan">Penyidikan</option><option value="P21">P21</option><option value="Persidangan">Persidangan</option><option value="Selesai">Selesai</option></select></div>
      </div>
      <div style="margin-top:16px;display:flex;gap:10px;justify-content:flex-end;">
        <button class="btn btn-ghost" onclick="hideForm('form-tipidana')">BATAL</button>
        <button class="btn btn-primary" onclick="addTipidana()">SIMPAN</button>
      </div>
    </div>
    <div class="card"><div class="table-wrapper"><table id="tbl-tipidana"><thead><tr><th>No</th><th>Nomor Kasus</th><th>Tgl Laporan</th><th>Tersangka</th><th>Jenis Pidana</th><th>Pasal</th><th>Instansi</th><th>Objek/Lokasi</th><th>Status</th><th>Aksi</th></tr></thead><tbody id="tbody-tipidana"></tbody></table></div></div>
  </div>

</main>

<div class="modal-overlay" id="modal-detail">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title" id="modal-detail-title">DETAIL DATA</div>
      <button class="close-btn" onclick="closeModal('modal-detail')"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button>
    </div>
    <div id="modal-detail-body"></div>
    <div class="modal-footer"><button class="btn btn-ghost" onclick="closeModal('modal-detail')">TUTUP</button></div>
  </div>
</div>

<div class="modal-overlay" id="modal-calendar">
  <div class="modal" style="max-width:480px;">
    <div class="modal-header">
      <div class="modal-title">TAMBAH AGENDA KALENDER</div>
      <button class="close-btn" onclick="closeModal('modal-calendar')"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button>
    </div>
    <div class="form-grid" style="grid-template-columns:1fr;">
      <div class="form-group"><label>Tanggal</label><input type="date" id="cal-date"></div>
      <div class="form-group"><label>Judul Agenda</label><input type="text" id="cal-title" placeholder="Contoh: Sidang Mediasi Kasus #SNG-047"></div>
      <div class="form-group"><label>Keterangan</label><textarea id="cal-desc" placeholder="Keterangan tambahan..." rows="3"></textarea></div>
      <div class="form-group"><label>Jenis Kegiatan</label>
        <select id="cal-type">
          <option value="Mediasi">Mediasi Sengketa</option><option value="Sidang">Sidang Perkara</option>
          <option value="Rapat">Rapat Internal</option><option value="Kunjungan">Kunjungan Lapangan</option>
          <option value="Pelatihan">Pelatihan/Bimtek</option><option value="Lainnya">Lainnya</option>
        </select>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeModal('modal-calendar')">BATAL</button>
      <button class="btn btn-primary" onclick="saveCalendarEvent()">SIMPAN AGENDA</button>
    </div>
  </div>
</div>

<div id="toast">
  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
  <span id="toast-msg">Data berhasil disimpan</span>
</div>

<script>
  // ==============================
// FITUR TEMA (LIGHT/DARK MODE)
// ==============================
function toggleTheme() {
  const body = document.body;
  const currentTheme = body.getAttribute('data-theme');
  const themeIcon = document.getElementById('theme-icon');
  
  if (currentTheme === 'light') {
    body.removeAttribute('data-theme');
    localStorage.setItem('sikanda_theme', 'dark');
    themeIcon.innerHTML = '<circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>'; // Sun icon
  } else {
    body.setAttribute('data-theme', 'light');
    localStorage.setItem('sikanda_theme', 'light');
    themeIcon.innerHTML = '<path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>'; // Moon icon
  }
}

// Cek tema saat halaman dimuat
if (localStorage.getItem('sikanda_theme') === 'light') {
  document.body.setAttribute('data-theme', 'light');
  document.getElementById('theme-icon').innerHTML = '<path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>';

// ==============================
// 1. SISTEM LOGIN & AUTENTIKASI
// ==============================
function checkLogin() {
  const isLogged = sessionStorage.getItem('sikanda_logged');
  if(isLogged === 'true') { document.getElementById('login-overlay').style.display = 'none'; }
}
function login() {
  const pwd = document.getElementById('login-pwd').value;
  if(pwd === 'admin') {
    sessionStorage.setItem('sikanda_logged', 'true');
    document.getElementById('login-overlay').style.opacity = '0';
    setTimeout(() => document.getElementById('login-overlay').style.display = 'none', 500);
  } else {
    document.getElementById('login-error').style.opacity = '1';
  }
}
function verifyLogin() { login(); }
function logout() { sessionStorage.removeItem('sikanda_logged'); location.reload(); }

// ==============================
// 2. DATA WILAYAH NTB (Untuk Dropdown Pembatalan)
// ==============================
const NTB_DATA = {
  'Kota Mataram': { 'Ampenan': ['Ampenan Selatan','Ampenan Tengah','Ampenan Utara','Banjar','Dayan Peken','Kebon Sari','Pejarakan Karya','Pejeruk','Taman Sari'], 'Cakranegara': ['Cakranegara Barat','Cakranegara Selatan','Cakranegara Selatan Baru','Cakranegara Timur','Cakranegara Utara','Cilinaya','Mayura','Sapta Marga','Sayang-Sayang','Sweta'], 'Mataram': ['Dasan Agung','Dasan Agung Baru','Gomong','Kekalik Jaya','Pagutan','Pagutan Barat','Pagutan Timur','Pagesangan','Pagesangan Barat','Pagesangan Timur','Pejanggik','Punia','Sekarbela'], 'Sandubaya': ['Abian Tubuh Baru','Babakan','Bertais','Dasan Cermen','Karang Pule','Mandalika','Selagalas','Turida'], 'Sekarbela': ['Jempong Baru','Karang Pule','Kekalik Jaya','Perampuan','Tanjung Karang','Tanjung Karang Permai'], 'Selaparang': ['Dasan Agung','Gomong','Karang Baru','Monjok','Monjok Barat','Monjok Timur','Rembiga','Tempe'] },
  'Kota Bima': { 'Asakota': ['Jatibaru','Jatibaru Timur','Kolo','Melayu','Penana'], 'Mpunda': ['Dara','Lewirato','Manggemaci','Monggonao','Penatoi','Penaraga','Pene','Sadia','Sambinae'], 'Raba': ['Boro','Kendo','Kumbe','Lampe','Ntobo','Rabangodu Selatan','Rabangodu Utara','Rabadompu Barat','Rabadompu Timur','Rontu'], 'Rasanae Barat': ['Dodu','Fluid','Lelamase','Nae','Panggi','Paruga','Sarae','Tanjung'], 'Rasanae Timur': ['Oi Fo\'o','Rite','Nitu','Kodo','Kumbe','Dodu'] },
  'Kabupaten Lombok Barat': { 'Batu Layar': ['Batu Layar','Batu Layar Barat','Gerung Selatan','Lembah Sari','Meninting','Sandik','Senggigi','Suka Makmur'], 'Gerung': ['Babussalam','Beleke','Dasan Tapen','Gerung Selatan','Gerung Utara','Giri Sasak','Kebon Ayu','Mesanggok','Ngur Lembang','Suka Makmur','Tempos','Taman Ayu'], 'Gunung Sari': ['Gunung Sari','Jeringo','Kekait','Krama Jaya','Mekarsari','Midang','Penimbung','Perampuan','Sigerongan','Taman Sari','Tamansari','Sesela'], 'Kediri': ['Aik Ampat','Dasan Tapen','Gelogor','Kediri','Kediri Selatan','Kuripan','Kuripan Selatan','Kuripan Utara','Lelede','Montong Are','Rumak'], 'Labuapi': ['Bajur','Bengkel','Kuranji','Kuranji Dalang','Labuapi','Perempuan','Telaga Waru','Terong Tawah','Merembu'], 'Lembar': ['Batu Putih','Jembatan Kembar','Jembatan Kembar Timur','Lembar','Lembar Selatan','Mareje','Sekotong Tengah','Pelangan'], 'Lingsar': ['Batu Mekar','Dasan Geria','Gegerung','Karang Baru','Langko','Lingsar','Sigerongan','Wanasaba Lauk','Karang Bayan'], 'Narmada': ['Badrain','Batu Mekar','Berembeng','Dasan Tereng','Gegelang','Golong','Lembuak','Lembung Reak','Mekar Sari','Narmada','Nyiur Lembang','Pakuan','Peresak','Selat','Sesaot','Suranadi','Sembung','Lebah Sempage'], 'Sekotong': ['Batu Putih','Buwun Mas','Gili Gede Indah','Kedaro','Pelangan','Sekotong Barat','Sekotong Tengah','Taman Baru','Telaga Lebur'] },
  'Kabupaten Lombok Tengah': { 'Batukliang': ['Aik Darek','Beber','Bunkate','Ganti','Karang Sidemen','Mantang','Mas-Mas','Montong Gamang','Pringgarata','Sepakek','Selebung'], 'Janapria': ['Durian','Janapria','Kidang','Mujur','Serage','Sukarara','Sukarara Timur','Tanak Rarang'], 'Jonggat': ['Aik Mual','Batu Tulis','Ganti','Gemel','Gonjak','Karang Daye','Labulia','Lelong','Lekor','Nyerot','Pandan Indah','Puyung','Sukarara','Ubung'], 'Kopang': ['Beraim','Dasan Baru','Dasan Lekong','Kopang','Kopang Rembiga','Montong Gamang','Orong Gerisak','Perian','Semparu','Woja'], 'Praya': ['Gerunung','Jontlak','Kelurahan Praya','Leneng','Mertak Tombok','Montong Terep','Semayan','Tiwugalih','Aik Mual','Kerembong'], 'Pujut': ['Kuta','Mertak','Pengembur','Pujut','Rambitan','Sade','Sengkol','Sukadana','Tumpak'] },
  'Kabupaten Lombok Timur': { 'Aikmel': ['Aikmel','Aikmel Barat','Aikmel Utara','Aikmel Timur','Danger','Jerowaru','Kembang Kerang','Kembang Kerang Daya','Lenek','Lenek Baru','Lenek Daya','Lenek Lauk','Suela'], 'Sikur': ['Aik Dewa','Aik Prapa','Bagek Payung','Bagek Payung Barat','Bagek Payung Timur','Dasan Lekong','Kota Raja','Montong Baan','Montong Baan Selatan','Montong Baan Timur','Sikur','Sikur Barat','Sikur Selatan'], 'Selong': ['Denggen','Denggen Timur','Gelanggang','Kelurahan Rakam','Kelurahan Selong','Kelurahan Sekarteja','Kembang Sari','Kesik','Lendang Re','Majidi','Pancor','Paokmotong','Rakam'] },
  'Kabupaten Lombok Utara': { 'Bayan': ['Akar-Akar','Anyar','Bayan','Loloan','Senaru','Sambik Elen','Sukadana'], 'Gangga': ['Bentek','Genggelang','Gondang','Kayangan','Rempek','Sambik Bangkol'], 'Tanjung': ['Jenggala','Medana','Sigar Penjalin','Sokong','Sugian','Tanjung','Teniga'] },
  'Kabupaten Sumbawa': { 'Alas': ['Alas','Alas Barat','Kalimango','Labuhan Sumbawa','Luar','Mapin Kebak','Mapin Rea','Pulau Kaung','Selang','Sepaukur','Tepal'], 'Sumbawa': ['Brang Biji','Bugis','Kelurahan Brang Biji','Kelurahan Lempeh','Kelurahan Pekat','Kelurahan Samapuin','Kelurahan Uma Sima','Kelurahan Brang Bara'] },
  'Kabupaten Sumbawa Barat': { 'Taliwang': ['Batu Putih','Bugis','Dalam','Dst','Karang Baru','Lalar','Lamulung','Menala','Seloto','Sermong','Tamekan','Telaga Bertong','Tongo','Torotangga'] },
  'Kabupaten Dompu': { 'Dompu': ['Bada','Bara','Bali I','Bali II','Dorotangga','Kandai I','Kandai II','Karijawa','Manggelewa','Montabaru','Monta Baru','Wawonduru'] },
  'Kabupaten Bima': { 'Woha': ['Belo','Kalampa','Kowo','Nisa','Roka','Samili','Talabiu','Tente','Wadukopa','Woha'] }
};

function onKabKotaChange() {
  const kabkota = document.getElementById('pmb-kabkota').value;
  const kecEl = document.getElementById('pmb-kecamatan');
  const desaEl = document.getElementById('pmb-desa');
  kecEl.innerHTML = '<option value="">-- Pilih Kecamatan --</option>';
  desaEl.innerHTML = '<option value="">-- Pilih Desa/Kelurahan --</option>';
  desaEl.disabled = true;
  if (!kabkota || !NTB_DATA[kabkota]) { kecEl.disabled = true; return; }
  kecEl.disabled = false;
  Object.keys(NTB_DATA[kabkota]).sort().forEach(kec => {
    const opt = document.createElement('option'); opt.value = kec; opt.textContent = kec; kecEl.appendChild(opt);
  });
}

function onKecamatanChange() {
  const kabkota = document.getElementById('pmb-kabkota').value, kecamatan = document.getElementById('pmb-kecamatan').value;
  const desaEl = document.getElementById('pmb-desa');
  desaEl.innerHTML = '<option value="">-- Pilih Desa/Kelurahan --</option>';
  if (!kabkota || !kecamatan || !NTB_DATA[kabkota][kecamatan]) { desaEl.disabled = true; return; }
  desaEl.disabled = false;
  NTB_DATA[kabkota][kecamatan].sort().forEach(d => {
    const opt = document.createElement('option'); opt.value = d; opt.textContent = d; desaEl.appendChild(opt);
  });
}

// ==============================
// 3. DATABASE (LOCAL STORAGE PERSISTENCE)
// ==============================
let DB = JSON.parse(localStorage.getItem('sikanda_db'));
if (!DB) {
  DB = {
    suratMasuk: [
      { id:1, nomor:'021/SM/II/2025', tanggal:'2025-02-21', asal:'Kantor ATR/BPN Lombok Barat', perihal:'Sengketa HM No.123', status:'Diproses', disposisi:'Kabid PPSEN' },
      { id:2, nomor:'018/SM/II/2025', tanggal:'2025-02-18', asal:'Pengadilan Negeri Mataram', perihal:'Panggilan Sidang Perkara No. 45/Pdt', status:'Diterima', disposisi:'Kasubid Sengketa' }
    ],
    suratKeluar: [
      { id:1, nomor:'015/SK/II/2025', tanggal:'2025-02-20', tujuan:'Kantor ATR/BPN Sumbawa', perihal:'Balasan Sengketa Pertanahan', ttd:'Kepala Kanwil BPN NTB', status:'Terkirim' }
    ],
    pembatalan: [
      { id:1, nomor:'PMB-032', tanggal:'2025-02-19', pemohon:'H. Lalu Muhamad Rizky', objek:'HM No. 445', kabkota:'Kota Mataram', letak:'Desa Pagutan, Kec. Mataram', alasan:'Cacat Administrasi', status:'Baru' }
    ],
    perkara: [
      { id:1, nomor:'PKR-009', tanggal:'2025-02-05', penggugat:'PT Graha Lombok', tergugat:'Pemerintah Kota Mataram', register:'45/Pdt.G/2025', objek:'HGB No. 12', pengadilan:'PN Mataram', status:'Aktif' }
    ],
    sengketa: [
      { id:1, nomor:'SNG-047', tanggal:'2025-02-20', pemohon:'Hj. Fatimah Zuhri', terlapor:'H. Mustafa', objek:'HM No. 891', letak:'Desa Labu Api', jenis:'Tumpang Tindih Sertipikat', status:'Mediasi' }
    ],
    tipidana: [
      { id:1, nomor:'TPA-011', tanggal:'2025-02-15', tersangka:'Bambang Purwanto', jenis:'Pemalsuan Sertipikat', pasal:'Pasal 263 KUHP', instansi:'Polda NTB', objek:'HM No. 556', status:'Penyidikan' }
    ],
    calendarEvents: {
      '2025-02-21': [{ title:'Mediasi SNG-047', desc:'Mediasi sengketa HM No. 891', type:'Mediasi' }],
      '2025-02-25': [{ title:'Sidang PKR-009', desc:'Persidangan PN Mataram perkara 45/Pdt.G', type:'Sidang' }],
      '2025-02-28': [{ title:'Rapat Koordinasi', desc:'Rapat internal bidang PPSEN', type:'Rapat' }]
    }
  };
  saveDB();
}

function saveDB() {
  localStorage.setItem('sikanda_db', JSON.stringify(DB));
  updateStats();
}

// ==============================
// 4. NAVIGATION & UI
// ==============================
const pageConfig = {
  'dashboard': { title: 'DASHBOARD', breadcrumb: 'Beranda / Dashboard' },
  'surat-masuk': { title: 'SURAT MASUK', breadcrumb: 'Beranda / Surat / Surat Masuk' },
  'surat-keluar': { title: 'SURAT KELUAR', breadcrumb: 'Beranda / Surat / Surat Keluar' },
  'pembatalan': { title: 'PERMOHONAN PEMBATALAN', breadcrumb: 'Beranda / Pembatalan' },
  'perkara': { title: 'PENANGANAN PERKARA', breadcrumb: 'Beranda / Perkara & Sengketa / Perkara' },
  'sengketa': { title: 'PENANGANAN SENGKETA', breadcrumb: 'Beranda / Perkara & Sengketa / Sengketa' },
  'tipidana': { title: 'TINDAK PIDANA PERTANAHAN', breadcrumb: 'Beranda / Pidana / Tipidana' },
};
const navHistory = [];
let currentPage = 'dashboard';

function navigateTo(pageId, navEl, pushHistory = true) {
  if (pushHistory && currentPage && currentPage !== pageId) navHistory.push(currentPage);
  currentPage = pageId;

  const backBtn = document.getElementById('back-btn');
  if (pageId === 'dashboard' || navHistory.length === 0) backBtn.classList.remove('visible'); else backBtn.classList.add('visible');

  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.getElementById('page-' + pageId).classList.add('active');

  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  if (navEl) navEl.classList.add('active');
  else document.querySelectorAll('.nav-item').forEach(item => { if (item.getAttribute('onclick') && item.getAttribute('onclick').includes(`'${pageId}'`)) item.classList.add('active'); });

  const cfg = pageConfig[pageId];
  if (cfg) { document.getElementById('page-title').textContent = cfg.title; document.getElementById('breadcrumb').textContent = cfg.breadcrumb; }

  if (pageId !== 'dashboard') renderTable(pageId.replace('surat-', ''));
}
function navigateToWithNav(pageId) {
  const navItems = document.querySelectorAll('.nav-item');
  let found = null;
  navItems.forEach(item => { if (item.getAttribute('onclick') && item.getAttribute('onclick').includes(`'${pageId}'`)) found = item; });
  navigateTo(pageId, found);
}
function goBack() { if (navHistory.length === 0) return; navigateTo(navHistory.pop(), null, false); }
function toggleSidebar() { document.getElementById('sidebar').classList.toggle('collapsed'); }

function updateClock() {
  const now = new Date();
  document.getElementById('clock').textContent = now.toLocaleTimeString('id-ID');
}
setInterval(updateClock, 1000); updateClock();

// ==============================
// 5. CALENDAR & HOLIDAYS
// ==============================
let calCurrent = new Date(); calCurrent.setDate(1);
let calSelected = null;
const MONTHS = ['JANUARI','FEBRUARI','MARET','APRIL','MEI','JUNI','JULI','AGUSTUS','SEPTEMBER','OKTOBER','NOVEMBER','DESEMBER'];

const HOLIDAYS = {
  '2025-01-01': 'Tahun Baru Masehi', '2025-01-27': 'Isra Mi\'raj', '2025-01-29': 'Tahun Baru Imlek', 
  '2025-03-29': 'Hari Raya Nyepi', '2025-03-31': 'Idul Fitri 1446 H', '2025-05-01': 'Hari Buruh', 
  '2025-05-12': 'Hari Raya Waisak', '2025-05-29': 'Kenaikan Isa Al Masih', '2025-06-01': 'Hari Lahir Pancasila', 
  '2025-06-06': 'Idul Adha 1446 H', '2025-06-27': 'Tahun Baru Islam', '2025-08-17': 'HUT RI', 
  '2025-09-05': 'Maulid Nabi', '2025-12-25': 'Hari Raya Natal'
};
function getHolidayName(dateStr) { return HOLIDAYS[dateStr] || null; }

function renderCalendar() {
  const year = calCurrent.getFullYear(), month = calCurrent.getMonth();
  document.getElementById('cal-month-label').textContent = `${MONTHS[month]} ${year}`;
  const grid = document.getElementById('cal-grid'); grid.innerHTML = '';
  
  const firstDay = new Date(year, month, 1).getDay();
  const daysInMonth = new Date(year, month + 1, 0).getDate();
  const daysInPrev = new Date(year, month, 0).getDate();
  const today = new Date();

  for (let i = 0; i < firstDay; i++) {
    const d = document.createElement('div'); d.className = 'cal-day other-month';
    d.innerHTML = `<span class="cal-day-inner">${daysInPrev - firstDay + 1 + i}</span>`; grid.appendChild(d);
  }

  for (let d = 1; d <= daysInMonth; d++) {
    const el = document.createElement('div'); el.className = 'cal-day';
    const dateStr = `${year}-${String(month+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
    const isToday = today.getFullYear() === year && today.getMonth() === month && today.getDate() === d;
    const holidayName = getHolidayName(dateStr);
    
    if (isToday) el.classList.add('today');
    if (holidayName) { el.classList.add('holiday'); el.setAttribute('data-holiday', holidayName); } 
    else if (new Date(year, month, d).getDay() === 0) { el.classList.add('is-sunday'); }
    
    if (DB.calendarEvents[dateStr] && DB.calendarEvents[dateStr].length > 0) el.classList.add('has-event');
    if (calSelected === dateStr) { el.style.outline = '2px solid var(--neon)'; el.style.outlineOffset = '-2px'; el.style.borderRadius = '8px'; }

    el.innerHTML = `<span class="cal-day-inner">${d}</span>`;
    el.onclick = () => selectCalDate(dateStr, d);
    grid.appendChild(el);
  }

  const remaining = (firstDay + daysInMonth) % 7 === 0 ? 0 : 7 - ((firstDay + daysInMonth) % 7);
  for (let i = 1; i <= remaining; i++) {
    const d = document.createElement('div'); d.className = 'cal-day other-month';
    d.innerHTML = `<span class="cal-day-inner">${i}</span>`; grid.appendChild(d);
  }
}

function selectCalDate(dateStr, dayNum) {
  calSelected = dateStr; renderCalendar();
  const label = document.getElementById('cal-selected-label');
  const listEl = document.getElementById('cal-event-list');
  label.textContent = `AGENDA ${dayNum} ${MONTHS[calCurrent.getMonth()]} ${calCurrent.getFullYear()}`;
  listEl.innerHTML = '';

  const holidayName = getHolidayName(dateStr);
  if (holidayName) {
    listEl.innerHTML += `<div style="display:flex;align-items:center;gap:8px;padding:8px 10px;border-radius:8px;margin-bottom:6px;background:rgba(255,61,85,0.08);border:1px solid rgba(255,61,85,0.25);"><div style="width:8px;height:8px;border-radius:50%;background:#ff3d55;flex-shrink:0;"></div><div><div style="font-weight:700;color:#ff6b6b;font-size:12px;">🇮🇩 Hari Libur Nasional</div><div style="font-size:11px;color:rgba(255,107,107,0.7);margin-top:1px;">${holidayName}</div></div></div>`;
  }

  const events = DB.calendarEvents[dateStr] || [];
  if (events.length === 0 && !holidayName) { listEl.innerHTML = '<div style="color:var(--text-dim);font-size:12px;padding:8px 0;">Belum ada agenda untuk tanggal ini.</div>'; return; }

  events.forEach((ev, idx) => {
    const item = document.createElement('div'); item.className = 'cal-event-item';
    item.innerHTML = `<div class="cal-event-dot"></div><div class="cal-event-text"><div style="font-weight:600;color:var(--text-bright);">${ev.title}</div><div class="cal-event-date">${ev.type} · ${ev.desc}</div></div><button class="icon-btn delete" onclick="deleteCalEvent('${dateStr}', ${idx})" title="Hapus"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button>`;
    listEl.appendChild(item);
  });
}

function deleteCalEvent(dateStr, idx) {
  DB.calendarEvents[dateStr].splice(idx, 1);
  if (DB.calendarEvents[dateStr].length === 0) delete DB.calendarEvents[dateStr];
  saveDB(); renderCalendar(); selectCalDate(dateStr, parseInt(dateStr.split('-')[2])); showToast('Agenda dihapus');
}
function changeMonth(dir) {
  calCurrent.setMonth(calCurrent.getMonth() + dir); calSelected = null;
  document.getElementById('cal-selected-label').textContent = '— PILIH TANGGAL UNTUK MELIHAT AGENDA —';
  document.getElementById('cal-event-list').innerHTML = ''; renderCalendar();
}
function openCalendarModal() {
  const today = new Date().toISOString().split('T')[0];
  document.getElementById('cal-date').value = calSelected || today;
  document.getElementById('cal-title').value = ''; document.getElementById('cal-desc').value = '';
  openModal('modal-calendar');
}
function saveCalendarEvent() {
  const date = document.getElementById('cal-date').value, title = document.getElementById('cal-title').value.trim(), desc = document.getElementById('cal-desc').value.trim(), type = document.getElementById('cal-type').value;
  if (!date || !title) { showToast('Tanggal dan judul agenda harus diisi!', true); return; }
  if (!DB.calendarEvents[date]) DB.calendarEvents[date] = [];
  DB.calendarEvents[date].push({ title, desc, type });
  saveDB(); const parts = date.split('-'); calCurrent = new Date(parseInt(parts[0]), parseInt(parts[1])-1, 1); calSelected = date;
  renderCalendar(); selectCalDate(date, parseInt(parts[2])); closeModal('modal-calendar'); showToast('Agenda berhasil ditambahkan!');
}

// ==============================
// 6. TABLES, FORMS & CRUD
// ==============================
function getBadgeClass(status) {
  const map = { 'Diterima':'badge-blue', 'Diproses':'badge-yellow', 'Selesai':'badge-green', 'Ditolak':'badge-red', 'Terkirim':'badge-green', 'Draf':'badge-yellow', 'Baru':'badge-blue', 'Mediasi':'badge-yellow', 'Gelar Kasus':'badge-blue', 'Penyelidikan':'badge-yellow', 'Aktif':'badge-blue', 'Banding':'badge-yellow', 'Kasasi':'badge-yellow', 'Inkracht':'badge-green', 'Penyidikan':'badge-yellow', 'Persidangan':'badge-yellow', 'P21':'badge-green', 'Laporan':'badge-blue' };
  return map[status] || 'badge-blue';
}

function renderTable(type) {
  const configs = {
    masuk: { data: DB.suratMasuk, tbody: 'tbody-masuk', cols: ['nomor','tanggal','asal','perihal','status','disposisi'] },
    keluar: { data: DB.suratKeluar, tbody: 'tbody-keluar', cols: ['nomor','tanggal','tujuan','perihal','ttd','status'] },
    pembatalan: { data: DB.pembatalan, tbody: 'tbody-pembatalan', cols: ['nomor','tanggal','pemohon','objek','kabkota','letak','alasan','status'] },
    perkara: { data: DB.perkara, tbody: 'tbody-perkara', cols: ['nomor','tanggal','penggugat','tergugat','register','objek','pengadilan','status'] },
    sengketa: { data: DB.sengketa, tbody: 'tbody-sengketa', cols: ['nomor','tanggal','pemohon','terlapor','objek','letak','jenis','status'] },
    tipidana: { data: DB.tipidana, tbody: 'tbody-tipidana', cols: ['nomor','tanggal','tersangka','jenis','pasal','instansi','objek','status'] },
  };
  const cfg = configs[type]; if (!cfg) return;
  const tbody = document.getElementById(cfg.tbody); tbody.innerHTML = '';
  
  cfg.data.forEach((row, i) => {
    let cells = `<td>${i+1}</td>`;
    cfg.cols.forEach(col => {
      if (col === 'status') cells += `<td><span class="badge ${getBadgeClass(row[col])}">${row[col]}</span></td>`;
      else { const val = row[col] || '-'; cells += `<td title="${val}">${val.length > 25 ? val.substring(0,24)+'…' : val}</td>`; }
    });
    cells += `<td>
      <div class="action-btns">
        <button class="icon-btn view" title="Lihat" onclick="viewDetail('${type}',${row.id})"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg></button>
        <button class="icon-btn delete" title="Hapus" onclick="deleteRecord('${type}',${row.id})"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14H6L5 6"/></svg></button>
      </div>
    </td>`;
    const tr = document.createElement('tr'); tr.innerHTML = cells; tbody.appendChild(tr);
  });
}

function filterTable(tableId, query) {
  const rows = document.querySelectorAll(`#${tableId} tbody tr`);
  rows.forEach(row => row.style.display = row.textContent.toLowerCase().includes(query.toLowerCase()) ? '' : 'none');
}
function filterTableStatus(tableId, status) {
  const rows = document.querySelectorAll(`#${tableId} tbody tr`);
  rows.forEach(row => {
    if (!status) { row.style.display = ''; return; }
    let show = false;
    row.querySelectorAll('.badge').forEach(b => { if (b.textContent === status) show = true; });
    row.style.display = show ? '' : 'none';
  });
}

function showAddForm(id) { document.getElementById('form-'+id).style.display = 'block'; }
function hideForm(id) { document.getElementById(id).style.display = 'none'; }
function openModal(id) { document.getElementById(id).classList.add('open'); }
function closeModal(id) { document.getElementById(id).classList.remove('open'); }

function viewDetail(type, id) {
  const mapData = { masuk: DB.suratMasuk, keluar: DB.suratKeluar, pembatalan: DB.pembatalan, perkara: DB.perkara, sengketa: DB.sengketa, tipidana: DB.tipidana };
  const row = mapData[type]?.find(r => r.id === id); if (!row) return;
  const titles = { masuk: 'DETAIL SURAT MASUK', keluar: 'DETAIL SURAT KELUAR', pembatalan: 'DETAIL PERMOHONAN PEMBATALAN', perkara: 'DETAIL PENANGANAN PERKARA', sengketa: 'DETAIL PENANGANAN SENGKETA', tipidana: 'DETAIL TINDAK PIDANA PERTANAHAN' };
  
  document.getElementById('modal-detail-title').textContent = titles[type];
  document.getElementById('modal-detail-body').innerHTML = Object.entries(row).filter(([k]) => k !== 'id').map(([k, v]) => {
    const label = k.charAt(0).toUpperCase() + k.slice(1);
    return `<div class="info-row"><span class="key">${label.replace(/([A-Z])/g, ' $1').trim()}</span><span class="val">${k === 'status' ? `<span class="badge ${getBadgeClass(v)}">${v}</span>` : v}</span></div>`;
  }).join('');
  openModal('modal-detail');
}

function deleteRecord(type, id) {
  const map = { masuk: 'suratMasuk', keluar: 'suratKeluar', pembatalan: 'pembatalan', perkara: 'perkara', sengketa: 'sengketa', tipidana: 'tipidana' };
  DB[map[type]] = DB[map[type]].filter(r => r.id !== id);
  saveDB(); renderTable(type); showToast('Data berhasil dihapus!');
}

function getNextId(arr) { return arr.length ? Math.max(...arr.map(r => r.id)) + 1 : 1; }

function addSuratMasuk() {
  const nomor = document.getElementById('sm-nomor').value.trim(), tanggal = document.getElementById('sm-tanggal').value, asal = document.getElementById('sm-asal').value.trim(), perihal = document.getElementById('sm-perihal').value.trim(), status = document.getElementById('sm-status').value, disposisi = document.getElementById('sm-disposisi').value.trim();
  if (!nomor || !tanggal || !asal || !perihal) { showToast('Lengkapi semua field yang wajib diisi!', true); return; }
  DB.suratMasuk.unshift({ id: getNextId(DB.suratMasuk), nomor, tanggal, asal, perihal, status, disposisi });
  saveDB(); renderTable('masuk'); hideForm('form-surat-masuk'); showToast('Surat masuk disimpan!');
  ['sm-nomor','sm-tanggal','sm-asal','sm-perihal','sm-disposisi'].forEach(id => document.getElementById(id).value = '');
}
function addSuratKeluar() {
  const nomor = document.getElementById('sk-nomor').value.trim(), tanggal = document.getElementById('sk-tanggal').value, tujuan = document.getElementById('sk-tujuan').value.trim(), perihal = document.getElementById('sk-perihal').value.trim(), ttd = document.getElementById('sk-ttd').value.trim(), status = document.getElementById('sk-status').value;
  if (!nomor || !tanggal || !tujuan || !perihal) { showToast('Lengkapi semua field yang wajib diisi!', true); return; }
  DB.suratKeluar.unshift({ id: getNextId(DB.suratKeluar), nomor, tanggal, tujuan, perihal, ttd, status });
  saveDB(); renderTable('keluar'); hideForm('form-surat-keluar'); showToast('Surat keluar disimpan!');
  ['sk-nomor','sk-tanggal','sk-tujuan','sk-perihal','sk-ttd'].forEach(id => document.getElementById(id).value = '');
}
function addPembatalan() {
  const nomor = document.getElementById('pmb-nomor').value.trim(), tanggal = document.getElementById('pmb-tanggal').value, pemohon = document.getElementById('pmb-pemohon').value.trim(), objek = document.getElementById('pmb-objek').value.trim(), kabkota = document.getElementById('pmb-kabkota').value, kecamatan = document.getElementById('pmb-kecamatan').value, desa = document.getElementById('pmb-desa').value, alasan = document.getElementById('pmb-alasan').value, status = document.getElementById('pmb-status').value;
  if (!nomor || !tanggal || !pemohon || !kabkota) { showToast('Lengkapi semua field yang wajib diisi!', true); return; }
  const letak = [desa, kecamatan ? 'Kec. ' + kecamatan : ''].filter(Boolean).join(', ');
  DB.pembatalan.unshift({ id: getNextId(DB.pembatalan), nomor, tanggal, pemohon, objek, kabkota, letak, alasan, status });
  saveDB(); renderTable('pembatalan'); hideForm('form-pembatalan'); showToast('Permohonan disimpan!');
  ['pmb-nomor','pmb-tanggal','pmb-pemohon','pmb-objek'].forEach(id => document.getElementById(id).value = '');
}
function addPerkara() {
  const nomor = document.getElementById('prk-nomor').value.trim(), tanggal = document.getElementById('prk-tanggal').value, penggugat = document.getElementById('prk-penggugat').value.trim(), tergugat = document.getElementById('prk-tergugat').value.trim(), register = document.getElementById('prk-register').value.trim(), objek = document.getElementById('prk-objek').value.trim(), pengadilan = document.getElementById('prk-pengadilan').value.trim(), status = document.getElementById('prk-status').value;
  if (!nomor || !tanggal || !penggugat) { showToast('Lengkapi semua field yang wajib diisi!', true); return; }
  DB.perkara.unshift({ id: getNextId(DB.perkara), nomor, tanggal, penggugat, tergugat, register, objek, pengadilan, status });
  saveDB(); renderTable('perkara'); hideForm('form-perkara'); showToast('Data perkara disimpan!');
  ['prk-nomor','prk-tanggal','prk-penggugat','prk-tergugat','prk-register','prk-objek','prk-pengadilan'].forEach(id => document.getElementById(id).value = '');
}
function addSengketa() {
  const nomor = document.getElementById('sng-nomor').value.trim(), tanggal = document.getElementById('sng-tanggal').value, pemohon = document.getElementById('sng-pemohon').value.trim(), terlapor = document.getElementById('sng-terlapor').value.trim(), objek = document.getElementById('sng-objek').value.trim(), letak = document.getElementById('sng-letak').value.trim(), jenis = document.getElementById('sng-jenis').value, status = document.getElementById('sng-status').value;
  if (!nomor || !tanggal || !pemohon) { showToast('Lengkapi semua field yang wajib diisi!', true); return; }
  DB.sengketa.unshift({ id: getNextId(DB.sengketa), nomor, tanggal, pemohon, terlapor, objek, letak, jenis, status });
  saveDB(); renderTable('sengketa'); hideForm('form-sengketa'); showToast('Data sengketa disimpan!');
  ['sng-nomor','sng-tanggal','sng-pemohon','sng-terlapor','sng-objek','sng-letak'].forEach(id => document.getElementById(id).value = '');
}
function addTipidana() {
  const nomor = document.getElementById('tpa-nomor').value.trim(), tanggal = document.getElementById('tpa-tanggal').value, tersangka = document.getElementById('tpa-tersangka').value.trim(), jenis = document.getElementById('tpa-jenis').value, pasal = document.getElementById('tpa-pasal').value.trim(), instansi = document.getElementById('tpa-instansi').value.trim(), objek = document.getElementById('tpa-objek').value.trim(), status = document.getElementById('tpa-status').value;
  if (!nomor || !tanggal || !tersangka) { showToast('Lengkapi semua field yang wajib diisi!', true); return; }
  DB.tipidana.unshift({ id: getNextId(DB.tipidana), nomor, tanggal, tersangka, jenis, pasal, instansi, objek, status });
  saveDB(); renderTable('tipidana'); hideForm('form-tipidana'); showToast('Data pidana disimpan!');
  ['tpa-nomor','tpa-tanggal','tpa-tersangka','tpa-pasal','tpa-instansi','tpa-objek'].forEach(id => document.getElementById(id).value = '');
}

// ==============================
// 7. EXPORT CSV & STATS
// ==============================
function exportCSV(type) {
  const map = { masuk:'suratMasuk', keluar:'suratKeluar', pembatalan:'pembatalan', perkara:'perkara', sengketa:'sengketa', tipidana:'tipidana' };
  const data = DB[map[type]];
  if(data.length === 0) { showToast('Data kosong', true); return; }
  
  const headers = Object.keys(data[0]).filter(k => k !== 'id');
  let csvContent = "data:text/csv;charset=utf-8," + headers.join(",") + "\n";
  data.forEach(row => { csvContent += headers.map(h => `"${row[h] || ''}"`).join(",") + "\n"; });
  
  const encodedUri = encodeURI(csvContent);
  const link = document.createElement("a");
  link.setAttribute("href", encodedUri);
  link.setAttribute("download", `SIKANDA_${type}_${new Date().toISOString().split('T')[0]}.csv`);
  document.body.appendChild(link); link.click(); document.body.removeChild(link);
  showToast('Berhasil diekspor ke CSV!');
}

function updateStats() {
  document.getElementById('stat-masuk').textContent = DB.suratMasuk.length;
  document.getElementById('stat-keluar').textContent = DB.suratKeluar.length;
  document.getElementById('stat-pembatalan').textContent = DB.pembatalan.length;
  document.getElementById('stat-perkara').textContent = DB.perkara.length;
  document.getElementById('stat-sengketa').textContent = DB.sengketa.length;
  document.getElementById('stat-tipidana').textContent = DB.tipidana.length;
  
  document.getElementById('badge-masuk').textContent = DB.suratMasuk.filter(s => s.status === 'Diterima' || s.status === 'Diproses').length;
  document.getElementById('badge-keluar').textContent = DB.suratKeluar.filter(s => s.status === 'Draf').length;
}

let toastTimer;
function showToast(msg, isError = false) {
  const toast = document.getElementById('toast'); document.getElementById('toast-msg').textContent = msg;
  toast.style.borderColor = isError ? 'var(--danger)' : 'var(--neon)'; toast.style.color = isError ? 'var(--danger)' : 'var(--neon)';
  toast.classList.add('show'); clearTimeout(toastTimer); toastTimer = setTimeout(() => toast.classList.remove('show'), 3000);
}

// Init Function
checkLogin();
renderCalendar();
updateStats();
</script>
</body>
</html> 
